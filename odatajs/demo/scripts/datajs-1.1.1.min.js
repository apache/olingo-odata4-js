// Copyright (c) Microsoft.  All rights reserved.
// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
// files (the "Software"), to deal  in the Software without restriction, including without limitation the rights  to use, copy,
// modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the
// Software is furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  IMPLIED, INCLUDING BUT NOT LIMITED TO THE
// WARRANTIES OF MERCHANTABILITY,  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

﻿(function(n,t){var pt=n.datajs||{},r=n.OData||{},co,lo,ei,ly,ip;typeof define=="function"&&define.amd?(define("datajs",pt),define("OData",r)):(n.datajs=pt,n.OData=r),pt.version={major:1,minor:1,build:1};var bo=function(t){return n.ActiveXObject?new n.ActiveXObject(t):null},ot=function(n){return n!==null&&n!==t},fr=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return!0;return!1},it=function(n,i){return n!==t?n:i},o=function(t){if(arguments.length===1){n.setTimeout(t,0);return}var i=Array.prototype.slice.call(arguments,1);n.setTimeout(function(){t.apply(this,i)},0)},g=function(n,t){for(var i in t)n[i]=t[i];return n},er=function(n,t){if(n)for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return n[i];return null},e=function(n){return Object.prototype.toString.call(n)==="[object Array]"},cf=function(n){return Object.prototype.toString.call(n)==="[object Date]"},lf=function(n){return typeof n=="object"},s=function(n){return parseInt(n,10)},iu=function(n,t,i){n.hasOwnProperty(t)&&(n[i]=n[t],delete n[t])},ru=function(n){throw n;},ko=function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},af=function(n,i){return n!==t?n:i},rp=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,go=["scheme","authority","path","query","fragment"],vf=function(n){var i={isAbsolute:!1},r,t,u;if(n){if(r=rp.exec(n),r)for(t=0,u=go.length;t<u;t++)r[t+1]&&(i[go[t]]=r[t+1]);i.scheme&&(i.isAbsolute=!0)}return i},ns=function(n){return"".concat(n.scheme||"",n.authority||"",n.path||"",n.query||"",n.fragment||"")},up=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,fp=/%[0-9A-F]{2}/ig,ep=function(n){var i=vf(n),r=i.scheme,u=i.authority,t;return r&&(i.scheme=r.toLowerCase(),u&&(t=up.exec(u),t&&(i.authority="//"+(t[1]?t[1]+"@":"")+t[2].toLowerCase()+(t[3]?":"+t[3]:"")))),n=ns(i),n.replace(fp,function(n){return n.toLowerCase()})},c=function(n,t){var i,u,r,f;return t?(i=vf(n),i.isAbsolute)?n:(u=vf(t),r={},i.authority?(r.authority=i.authority,f=i.path,r.query=i.query):(i.path?(f=i.path.charAt(0)==="/"?i.path:op(i.path,u.path),r.query=i.query):(f=u.path,r.query=i.query||u.query),r.authority=u.authority),r.path=sp(f),r.scheme=u.scheme,r.fragment=i.fragment,ns(r)):n},op=function(n,t){var i="/",r;return t&&(r=t.lastIndexOf("/"),i=t.substring(0,r),i.charAt(i.length-1)!=="/"&&(i=i+"/")),i+n},sp=function(n){for(var t="",r="",i;n;)n.indexOf("..")===0||n.indexOf(".")===0?n=n.replace(/^\.\.?\/?/g,""):n.indexOf("/..")===0?(n=n.replace(/^\/\..\/?/g,"/"),i=t.lastIndexOf("/"),t=i===-1?"":t.substring(0,i)):n.indexOf("/.")===0?n=n.replace(/^\/\.\/?/g,"/"):(r=n,i=n.indexOf("/",1),i!==-1&&(r=n.substring(0,i)),t=t+r,n=n.replace(r,""));return t},hp=function(i){var r=[],o,u,f,s,e,h;if(n.atob===t)r=cp(i);else for(o=n.atob(i),u=0;u<o.length;u++)r.push(o.charCodeAt(u));for(f="",s="0123456789ABCDEF",e=0;e<r.length;e++)h=r[e],f+=s[h>>4],f+=s[h&15];return f},cp=function(n){for(var i="",r,u,f,e,o,t=0;t<n.length;t++)r=lp(n[t]),u="",r!==null&&(u=r.toString(2),i+=ap(u));for(f=[],e=parseInt(i.length/8,10),t=0;t<e;t++)o=parseInt(i.substring(t*8,(t+1)*8),2),f.push(o);return f},lp=function(n){var t=n.charCodeAt(0),i=65,r=6;return t>=65&&t<=90?t-i:t>=97&&t<=122?t-i-r:t>=48&&t<=57?t+4:n=="+"?62:n=="/"?63:null},ap=function(n){while(n.length<6)n="0"+n;return n},uu="http://",or=uu+"www.w3.org/",ts=or+"1999/xhtml",sr=or+"2000/xmlns/",yi=or+"XML/1998/namespace",is=uu+"www.mozilla.org/newlayout/xml/parsererror.xml",vp=function(n){var t=/(^\s)|(\s$)/;return t.test(n)},yp=function(n){var t=/^\s*$/;return n===null||t.test(n)},pp=function(n){while(n!==null&&n.nodeType===1){var t=st(n,"space",yi);if(t==="preserve")return!0;if(t==="default")break;else n=n.parentNode}return!1},wp=function(n){var t=n.nodeName;return t=="xmlns"||t.indexOf("xmlns:")===0},fu=function(n,t,i){try{n.setProperty(t,i)}catch(r){}},bp=function(){var n=bo("Msxml2.DOMDocument.3.0");return n&&(fu(n,"ProhibitDTD",!0),fu(n,"MaxElementDepth",256),fu(n,"AllowDocumentFunction",!1),fu(n,"AllowXsltScript",!1)),n},rs=function(){try{var n=bo("Msxml2.DOMDocument.6.0");return n&&(n.async=!0),n}catch(t){return bp()}},kp=function(n){var t=rs(),i;return t?(t.loadXML(n),i=t.parseError,i.errorCode!==0&&hr(i.reason,i.srcText,n),t):null},hr=function(n,t,i){typeof n=="string"&&(n={message:n});throw g(n,{srcText:t||"",errorXmlText:i||""});},eu=function(t){var s=n.DOMParser&&new n.DOMParser,r,e,l;if(!s)return r=kp(t),r||hr("XML DOM parser not supported"),r;try{r=s.parseFromString(t,"text/xml")}catch(v){hr(v,"",t)}var i=r.documentElement,h=i.namespaceURI,c=f(i);if(c==="parsererror"&&h===is&&(e=b(i,is,"sourcetext"),l=e?bi(e):"",hr(k(i)||"",l,t)),c==="h3"&&h===ts||nw(i,ts,"h3")){for(var o="",a=[],u=i.firstChild;u;)u.nodeType===1&&(o+=k(u)||""),a.push(u.nextSibling),u=u.firstChild||a.shift();o+=k(i)||"",hr(o,"",t)}return r},wt=function(n,t){return n?n+":"+t:t},dp=function(n,t){if(vp(t.data)){var i=wi(n,yi,"space");i||(i=si(n.ownerDocument,yi,wt("xml","space")),l(n,i)),i.value="preserve"}return n.appendChild(t),n},pi=function(n,t){for(var r=n.attributes,i=0,u=r.length;i<u;i++)t(r.item(i))},st=function(n,t,i){var r=wi(n,t,i);return r?bi(r):null},wi=function(n,t,i){var r=n.attributes;return r.getNamedItemNS?r.getNamedItemNS(i||null,t):r.getQualifiedItem(t,i)||null},rt=function(n,t){var i=wi(n,"base",yi);return(i?c(i.value,t):t)||null},p=function(n,t){yf(n,!1,function(n){return n.nodeType===1&&t(n),!0})},us=function(n,t,i){for(var u=i.split("/"),r=0,f=u.length;r<f;r++)n=n&&b(n,t,u[r]);return n||null},gp=function(n,t,i){var f=i.lastIndexOf("/"),r=i.substring(f+1),e=i.substring(0,f),u=e?us(n,t,e):n;return u?r.charAt(0)==="@"?wi(u,r.substring(1),t):b(u,t,r):null},b=function(n,t,i){return fs(n,t,i,!1)},nw=function(n,t,i){if(n.getElementsByTagNameNS){var r=n.getElementsByTagNameNS(t,i);return r.length>0?r[0]:null}return fs(n,t,i,!0)},fs=function(n,t,i,r){var e=null;return yf(n,r,function(n){if(n.nodeType===1){var r=!t||u(n)===t,o=!i||f(n)===i;r&&o&&(e=n)}return e===null}),e},k=function(n){var i=null,r=n.nodeType===9&&n.documentElement?n.documentElement:n,f=r.ownerDocument.preserveWhiteSpace===!1,u;return yf(r,!1,function(n){if(n.nodeType===3||n.nodeType===4){var e=bi(n),o=f||!yp(e);o||(u===t&&(u=pp(r)),o=u),o&&(i?i+=e:i=e)}return!0}),i},f=function(n){return n.localName||n.baseName},u=function(n){return n.namespaceURI||null},bi=function(n){return n.nodeType===1?k(n):n.nodeValue},yf=function(n,t,i){for(var f=[],r=n.firstChild,u=!0;r&&u;)u=i(r),u&&(t&&r.firstChild&&f.push(r.firstChild),r=r.nextSibling||f.shift())},tw=function(n,t,i){for(var r=n.nextSibling,e,o;r;){if(r.nodeType===1&&(e=!t||u(r)===t,o=!i||f(r)===i,e&&o))return r;r=r.nextSibling}return null},es=function(){var t=n.document.implementation;return t&&t.createDocument?t.createDocument(null,null,null):rs()},ou=function(n,t){if(!e(t))return l(n,t);for(var i=0,r=t.length;i<r;i++)t[i]&&l(n,t[i]);return n},l=function(n,t){if(t){if(typeof t=="string")return dp(n,rw(n.ownerDocument,t));t.nodeType===2?n.setAttributeNodeNS?n.setAttributeNodeNS(t):n.setAttributeNode(t):n.appendChild(t)}return n},si=function(n,i,r,u){var f=n.createAttributeNS&&n.createAttributeNS(i,r)||n.createNode(2,r,i||t);return f.value=u||"",f},cr=function(n,i,r,u){var f=n.createElementNS&&n.createElementNS(i,r)||n.createNode(1,r,i||t);return ou(f,u||[])},os=function(n,t,i){return si(n,sr,wt("xmlns",i),t)},iw=function(n,t){for(var f="<c>"+t+"<\/c>",e=eu(f),r=e.documentElement,o=("importNode"in n)?n.importNode(r,!0):r,u=n.createDocumentFragment(),i=o.firstChild;i;)u.appendChild(i),i=i.nextSibling;return u},rw=function(n,t){return n.createTextNode(t)},uw=function(n,t,i,r,u){for(var f="",h=u.split("/"),c=b,a=cr,o=t,e,s=0,v=h.length;s<v;s++)f=h[s],f.charAt(0)==="@"&&(f=f.substring(1),c=wi,a=si),e=c(o,i,f),e||(e=a(n,i,wt(r,f)),l(o,e)),o=e;return o},pf=function(t){var i=n.XMLSerializer,r;if(i)return r=new i,r.serializeToString(t);if(t.xml)return t.xml;throw{message:"XML serialization unsupported"};},fw=function(n){var f=n.childNodes,t,r=f.length,i;if(r===0)return"";var e=n.ownerDocument,o=e.createDocumentFragment(),u=e.createElement("c");for(o.appendChild(u),t=0;t<r;t++)u.appendChild(f[t]);for(i=pf(o),i=i.substr(3,i.length-7),t=0;t<r;t++)n.appendChild(u.childNodes[t]);return i},vit=function(i){var r=i.xml,u;if(r!==t)return r;if(n.XMLSerializer)return u=new n.XMLSerializer,u.serializeToString(i);throw{message:"XML serialization unsupported"};},ew=function(n,t,i){return function(){return n[t].apply(n,arguments),i}},ki=function(){this._arguments=t,this._done=t,this._fail=t,this._resolved=!1,this._rejected=!1};ki.prototype={then:function(n,t){return n&&(this._done?this._done.push(n):this._done=[n]),t&&(this._fail?this._fail.push(t):this._fail=[t]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){for(var n=0,i=this._done.length;n<i;n++)this._done[n].apply(null,arguments);this._done=t,this._resolved=!1,this._arguments=t}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){for(var n=0,i=this._fail.length;n<i;n++)this._fail[n].apply(null,arguments);this._fail=t,this._rejected=!1,this._arguments=t}else this._rejected=!0,this._arguments=arguments},promise:function(){var n={};return n.then=ew(this,"then",n),n}};var su=function(){return n.jQuery&&n.jQuery.Deferred?new n.jQuery.Deferred:new ki},ss=function(n,t){var i=(n&&n.__metadata||{}).type;return i||(t?t.type:null)},v="Edm.",hs=v+"Binary",cs=v+"Boolean",ls=v+"Byte",hu=v+"DateTime",cu=v+"DateTimeOffset",as=v+"Decimal",vs=v+"Double",ys=v+"Guid",ps=v+"Int16",ws=v+"Int32",bs=v+"Int64",ks=v+"SByte",ds=v+"Single",lr=v+"String",lu=v+"Time",ht=v+"Geography",gs=ht+"Point",nh=ht+"LineString",th=ht+"Polygon",ih=ht+"Collection",rh=ht+"MultiPolygon",uh=ht+"MultiLineString",fh=ht+"MultiPoint",et=v+"Geometry",eh=et+"Point",oh=et+"LineString",sh=et+"Polygon",hh=et+"Collection",ch=et+"MultiPolygon",lh=et+"MultiLineString",ah=et+"MultiPoint",wf="Point",bf="LineString",kf="Polygon",df="MultiPoint",gf="MultiLineString",ne="MultiPolygon",te="GeometryCollection",ow=[lr,ws,bs,cs,vs,ds,hu,cu,lu,as,ys,ls,ps,ks,hs],sw=[et,eh,oh,sh,hh,ch,lh,ah],hw=[ht,gs,nh,th,ih,rh,uh,fh],hi=function(n,t){if(!n)return null;if(e(n)){for(var r,i=0,u=n.length;i<u;i++)if(r=hi(n[i],t),r)return r;return null}return n.dataServices?hi(n.dataServices.schema,t):t(n)},vh=function(n,t){return n=n===0?"":"."+a(n.toString(),3),t>0&&(n===""&&(n=".000"),n+=a(t.toString(),4)),n},yh=function(n){var u,t,e;if(typeof n=="string")return n;if(u=vw(n),t=wh(n.__offset),u&&t!=="Z"){n=new Date(n.valueOf());var i=ec(t),o=n.getUTCHours()+i.d*i.h,s=n.getUTCMinutes()+i.d*i.m;n.setUTCHours(o,s)}else u||(t="");var r=n.getUTCFullYear(),h=n.getUTCMonth()+1,f="";return r<=0&&(r=-(r-1),f="-"),e=vh(n.getUTCMilliseconds(),n.__ns),f+a(r,4)+"-"+a(h,2)+"-"+a(n.getUTCDate(),2)+"T"+a(n.getUTCHours(),2)+":"+a(n.getUTCMinutes(),2)+":"+a(n.getUTCSeconds(),2)+e+t},ph=function(n){var t=n.ms,e="",i,r,u,f;return t<0&&(e="-",t=-t),i=Math.floor(t/864e5),t-=864e5*i,r=Math.floor(t/36e5),t-=36e5*r,u=Math.floor(t/6e4),t-=6e4*u,f=Math.floor(t/1e3),t-=f*1e3,e+"P"+a(i,2)+"DT"+a(r,2)+"H"+a(u,2)+"M"+a(f,2)+vh(t,n.ns)+"S"},a=function(n,t,i){for(var r=n.toString(10);r.length<t;)i?r+="0":r="0"+r;return r},wh=function(n){return!n||n==="Z"||n==="+00:00"||n==="-00:00"?"Z":n},au=function(n){if(typeof n=="string"){var t=n.indexOf(")",10);if(n.indexOf("Collection(")===0&&t>0)return n.substring(11,t)}return null},cw=function(n,i,r,u,f,e){return f.request(n,function(f){try{f.headers&&ee(f.headers),f.data===t&&f.statusCode!==204&&u.read(f,e)}catch(o){o.request===t&&(o.request=n),o.response===t&&(o.response=f),r(o);return}i(f.data,f)},r)},lw=function(n){return d(n)&&e(n.__batchRequests)},aw=/Collection\((.*)\)/,bh=function(n,t){var i=n&&n.results||n;return!!i&&vu(t)||!t&&e(i)&&!d(i[0])},vu=function(n){return aw.test(n)},d=function(n){return!!n&&lf(n)&&!e(n)&&!cf(n)},vw=function(n){return n.__edmType==="Edm.DateTimeOffset"||!n.__edmType&&n.__offset},kh=function(n){if(!n&&!d(n))return!1;var t=n.__metadata||{},i=n.__deferred||{};return!t.type&&!!i.uri},dh=function(n){return d(n)&&n.__metadata&&"uri"in n.__metadata},ar=function(n,t){var i=n&&n.results||n;return e(i)&&!vu(t)&&d(i[0])},ie=function(n){return fr(hw,n)},re=function(n){return fr(sw,n)},gh=function(n){if(!n&&!d(n))return!1;var i=n.__metadata,t=n.__mediaresource;return!i&&!!t&&!!t.media_src},yu=function(n){return cf(n)||typeof n=="string"||typeof n=="number"||typeof n=="boolean"},ue=function(n){return fr(ow,n)},nc=function(n,i){return kh(n)?"deferred":dh(n)?"entry":ar(n)?"feed":i&&i.relationship?n===null||n===t||!ar(n)?"entry":"feed":null},bt=function(n,t){return er(n,function(n){return n.name===t})},fe=function(n,t,i){return n?hi(t,function(t){return dw(n,t,i)}):null},yw=function(n,t){return er(n,function(n){return n.name===t})},di=function(n,t){return fe(n,t,"complexType")},kt=function(n,t){return fe(n,t,"entityType")},tc=function(n){return hi(n,function(n){return er(n.entityContainer,function(n){return oe(n.isDefaultEntityContainer)})})},ic=function(n,t){return fe(n,t,"entityContainer")},pw=function(n,t){return er(n,function(n){return n.name===t})},ww=function(n,t){var u=null,f,i,r;return n&&(f=n.relationship,i=hi(t,function(n){var r=rc(n.namespace,f),i=n.association,t,u;if(r&&i)for(t=0,u=i.length;t<u;t++)if(i[t].name===r)return i[t];return null}),i&&(r=i.end[0],r.role!==n.toRole&&(r=i.end[1]),u=r.type)),u},bw=function(n,t,i){if(n){var u=n.relationship,r=hi(i,function(n){for(var f=n.entityContainer,t,i,r=0;r<f.length;r++)if(t=f[r].associationSet,t)for(i=0;i<t.length;i++)if(t[i].association==u)return t[i];return null});if(r&&r.end[0]&&r.end[1])return r.end[0].entitySet==t?r.end[1].entitySet:r.end[0].entitySet}return null},kw=function(n,t){return hi(t,function(t){for(var f=t.entityContainer,r,u,i=0;i<f.length;i++)if(r=f[i].entitySet,r)for(u=0;u<r.length;u++)if(r[u].name==n)return{entitySet:r[u],containerName:f[i].name,functionImport:f[i].functionImport};return null})},rc=function(n,t){return t.indexOf(n)===0&&t.charAt(n.length)==="."?t.substr(n.length+1):null},dw=function(n,t,i){if(n&&t){var r=rc(t.namespace,n);if(r)return er(t[i],function(n){return n.name===r})}return null},ct=function(n,t){var i,f,e;if(n===t)return n;var r=n.split("."),u=t.split("."),o=r.length>=u.length?r.length:u.length;for(i=0;i<o;i++){if(f=r[i]&&s(r[i]),e=u[i]&&s(u[i]),f>e)return n;if(f<e)return t}},gw={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},ee=function(n){var t,r,i,u;for(t in n)r=t.toLowerCase(),i=gw[r],i&&t!==i&&(u=n[t],delete n[t],n[i]=u)},oe=function(n){return typeof n=="boolean"?n:typeof n=="string"&&n.toLowerCase()==="true"},nb=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?::(\d{2}))?(?:\.(\d+))?(.*)$/,uc=function(n,t,i){var r=nb.exec(n),o=r?wh(r[8]):null,h,u,e,c,l,f;if(!r||!t&&o!=="Z"){if(i)return null;throw{message:"Invalid date/time value"};}if(h=s(r[1]),h<=0&&h++,u=r[7],e=0,u){if(u.length>7){if(i)return null;throw{message:"Cannot parse date/time value to given precision."};}e=a(u.substring(3),4,!0),u=a(u.substring(0,3),3,!0),u=s(u),e=s(e)}else u=0;var v=s(r[4]),y=s(r[5]),p=s(r[6])||0;if(o!=="Z"&&(c=ec(o),l=-c.d,v+=c.h*l,y+=c.m*l),f=new Date,f.setUTCFullYear(h,s(r[2])-1,s(r[3])),f.setUTCHours(v,y,p,u),isNaN(f.valueOf())){if(i)return null;throw{message:"Invalid date/time value"};}return t&&(f.__edmType="Edm.DateTimeOffset",f.__offset=o),e&&(f.__ns=e),f},pu=function(n,t){return uc(n,!1,t)},se=function(n,t){return uc(n,!0,t)},fc=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,yit=function(n){fc.test(n)},he=function(n){var i=fc.exec(n),t,r,u;if(i===null)throw{message:"Invalid duration value."};var f=i[2]||"0",e=i[3]||"0",o=s(i[4]||0),h=s(i[5]||0),c=s(i[6]||0),l=parseFloat(i[7]||0);if(f!=="0"||e!=="0")throw{message:"Unsupported duration value."};if(t=i[8],r=0,t){if(t.length>7)throw{message:"Cannot parse duration value to given precision."};r=a(t.substring(3),4,!0),t=a(t.substring(0,3),3,!0),t=s(t),r=s(r)}else t=0;return t+=l*1e3+c*6e4+h*36e5+o*864e5,i[1]==="-"&&(t=-t),u={ms:t,__edmType:"Edm.Time"},r&&(u.ns=r),u},ec=function(n){var t=n.substring(0,1),i,r;return t=t==="+"?1:-1,i=s(n.substring(1)),r=s(n.substring(n.indexOf(":")+1)),{d:t,h:i,m:r}},oc=function(n,i,r){n.method||(n.method="GET"),n.headers?ee(n.headers):n.headers={},n.headers.Accept===t&&(n.headers.Accept=i.accept),ot(n.data)&&n.body===t&&i.write(n,r),ot(n.headers.MaxDataServiceVersion)||(n.headers.MaxDataServiceVersion=i.maxDataServiceVersion||"1.0")},sc=function(n,i,r){var u,e,f;if(n&&typeof n=="object")for(u in n)e=n[u],f=sc(e,u,r),f=r(u,f,i),f!==e&&(e===t?delete n[u]:n[u]=f);return n},tb=function(n,t){return t("",sc(n,"",t))},wu=0,ib=function(n){return n.method&&n.method!=="GET"?!1:!0},rb=function(t){var i=n.document.createElement("IFRAME");i.style.display="none";var r=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),u='<html><head><script type="text/javascript" src="'+r+'"><\/script><\/head><body><\/body><\/html>',f=n.document.getElementsByTagName("BODY")[0];return f.appendChild(i),hc(i,u),i},ub=function(){if(n.XMLHttpRequest)return new n.XMLHttpRequest;var t;if(n.ActiveXObject)try{return new n.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(i){try{return new n.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(r){t=r}}else t={message:"XMLHttpRequest not supported"};throw t;},fb=function(n){return n.indexOf("http://")===0||n.indexOf("https://")===0||n.indexOf("file://")===0},eb=function(t){if(!fb(t))return!0;var i=n.location,r=i.protocol+"//"+i.host+"/";return t.indexOf(r)===0},ob=function(i,r){try{delete n[i]}catch(u){n[i]=t,r===wu-1&&(wu-=1)}},bu=function(n){return n&&(hc(n,""),n.parentNode.removeChild(n)),null},sb=function(n,t){for(var r=n.getAllResponseHeaders().split(/\r?\n/),u,i=0,f=r.length;i<f;i++)r[i]&&(u=r[i].split(": "),t[u[0]]=u[1])},hc=function(n,t){var i=n.contentWindow?n.contentWindow.document:n.contentDocument.document;i.open(),i.write(t),i.close()};r.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(i,r,u){var y={},f=null,h=!1,s,a,w,b,k,d,l,v;y.abort=function(){(s=bu(s),h)||(h=!0,f&&(f.abort(),f=null),u({message:"Request aborted"}))};var p=function(){s=bu(s),h||(h=!0,f=null,u({message:"Request timed out"}))},c,e=i.requestUri,g=it(i.enableJsonpCallback,this.enableJsonpCallback),nt=it(i.callbackParameterName,this.callbackParameterName),tt=it(i.formatQueryString,this.formatQueryString);if(!g||eb(e)){if(f=ub(),f.onreadystatechange=function(){var t,n,o,s;h||f===null||f.readyState!==4||(t=f.statusText,n=f.status,n===1223&&(n=204,t="No Content"),o=[],sb(f,o),s={requestUri:e,statusCode:n,statusText:t,headers:o,body:f.responseText},h=!0,f=null,n>=200&&n<=299?r(s):u({message:"HTTP request failed",request:i,response:s}))},f.open(i.method||"GET",e,!0,i.user,i.password),i.headers)for(c in i.headers)f.setRequestHeader(c,i.headers[c]);i.timeoutMS&&(f.timeout=i.timeoutMS,f.ontimeout=p),f.send(i.body)}else{if(!ib(i))throw{message:"Request is not local and cannot be done through JSONP."};a=wu,wu+=1,w=a.toString(),b=!1,c="handleJSONP_"+w,n[c]=function(i){if(s=bu(s),!h){b=!0,n.clearTimeout(k),ob(c,a),n.ActiveXObject&&(i=n.JSON.parse(n.JSON.stringify(i)));var u;u=i.d===t?{"Content-Type":"application/json;odata.metadata=minimal",dataServiceVersion:"4.0"}:{"Content-Type":"application/json"},o(function(){bu(s),r({body:i,statusCode:200,headers:u})})}},d=i.timeoutMS?i.timeoutMS:12e4,k=n.setTimeout(p,d),l=nt+"=parent."+c,this.formatQueryString&&(l+="&"+tt),v=e.indexOf("?"),e=v===-1?e+"?"+l:v===e.length-1?e+l:e+"&"+l,s=rb(e)}return y}};var ci="4.0",gi=function(n){var t,r,i,f,u;if(!n)return null;for(t=n.split(";"),r={},i=1,f=t.length;i<f;i++)u=t[i].split("="),r[ko(u[0])]=u[1];return{mediaType:ko(t[0]),properties:r}},hb=function(n){if(!n)return t;var r=n.mediaType,i;for(i in n.properties)r+=";"+i+"="+n.properties[i];return r},cc=function(n,t,i,r){var u={};return g(u,i),g(u,{contentType:n,dataServiceVersion:t,handler:r}),u},lc=function(n,t,i){if(n){var r=n.headers;r[t]||(r[t]=i)}},cb=function(n,t){if(n){var i=n.headers,r=i.DataServiceVersion;i.DataServiceVersion=r?ct(r,t):t}},ac=function(n,i){var r=n.headers;return r&&r[i]||t},vc=function(n){return gi(ac(n,"Content-Type"))},lb=/^\s?(\d+\.\d+);?.*$/,yc=function(n){var i=ac(n,"DataServiceVersion"),t;if(i&&(t=lb.exec(i),t&&t.length))return t[1]},pc=function(n,t){return n.accept.indexOf(t.mediaType)>=0},ab=function(n,i,r,u){var f;if(!r||!r.headers)return!1;var e=vc(r),s=yc(r)||"",o=r.body;return ot(o)?pc(n,e)?(f=cc(e,s,u,n),f.response=r,r.data=i(n,o,f),r.data!==t):!1:!1},vb=function(n,i,r,u){var e,o,f;return!r||!r.headers?!1:(e=vc(r),o=yc(r),(!e||pc(n,e))&&(f=cc(e,o,u,n),f.request=r,r.body=i(n,r.data,f),r.body!==t))?(cb(r,f.dataServiceVersion||"1.0"),lc(r,"Content-Type",hb(f.contentType)),lc(r,"MaxDataServiceVersion",n.maxDataServiceVersion),!0):!1},li=function(n,t,i,r){return{accept:i,maxDataServiceVersion:r,read:function(t,i){return ab(this,n,t,i)},write:function(n,i){return vb(this,t,n,i)}}},yb=function(n,t){return t},pb=function(n,i){return ot(i)?i.toString():t};r.textHandler=li(yb,pb,"text/plain",ci);var wc=uu+"www.opengis.net",ut=wc+"/gml",bc=wc+"/def/crs/EPSG/0/",kc="gml",vr=function(n,t,i){var r={type:n};return r[t]=i,r},ce=function(n){if(e(n)&&n.length>=2){var t=n[0];n[0]=n[1],n[1]=t}return n},le=function(n,t,i,r,u,f){var e=dc(n,i,r,u,f);return vr(t,"coordinates",e)},dc=function(n,t,i,r,e){var o=[];return p(n,function(n){var s,h,c;if(u(n)===ut){if(s=f(n),s===t){h=b(n,ut),h&&(c=r(h,e),c&&o.push(c));return}s===i&&p(n,function(n){if(u(n)===ut){var t=r(n,e);t&&o.push(t)}})}}),o},wb=function(n,t){var i=dc(n,"geometryMember","geometryMembers",tl,t);return vr(te,"geometries",i)},bb=function(n,t){return vr(bf,"coordinates",ae(n,t))},kb=function(n,t){return le(n,gf,"curveMember","curveMembers",ae,t)},db=function(n,t){return le(n,df,"pointMember","pointMembers",ve,t)},gb=function(n,t){return le(n,ne,"surfaceMember","surfaceMembers",gc,t)},nk=function(n,t){return vr(wf,"coordinates",ve(n,t))},tk=function(n,t){return vr(kf,"coordinates",gc(n,t))},ae=function(n,t){var i=[];return p(n,function(n){var e=u(n),r;if(e===ut){if(r=f(n),r==="posList"){i=rk(n,t);return}if(r==="pointProperty"){i.push(ik(n,t));return}if(r==="pos"){i.push(ye(n,t));return}}}),i},ve=function(n,t){var i=b(n,ut,"pos");return i?ye(i,t):[]},ik=function(n,t){var i=b(n,ut,"Point");return i?ve(i,t):[]},gc=function(n,t){var i=[],r=!1;return p(n,function(n){if(u(n)===ut){var e=f(n);if(e==="exterior"){r=!0,i.unshift(nl(n,t));return}if(e==="interior"){i.push(nl(n,t));return}}}),!r&&i.length>0&&i.unshift([[]]),i},nl=function(n,t){var i=[];return p(n,function(n){u(n)===ut&&f(n)==="LinearRing"&&(i=ae(n,t))}),i},rk=function(n,t){var f=ye(n,!1),e=f.length,r,i,u;if(e%2!=0)throw{message:"GML posList element has an uneven number of numeric values"};for(r=[],i=0;i<e;i+=2)u=f.slice(i,i+2),r.push(t?ce(u):u);return r},ye=function(n,t){var u=[],o=" \t\r\n",r=k(n),f;if(r)for(var s=r.length,e=0,i=0;i<=s;)o.indexOf(r.charAt(i))!==-1&&(f=r.substring(e,i),f&&u.push(parseFloat(f)),e=i+1),i++;return t?ce(u):u},tl=function(n,t){var o=f(n),i,u,r,e;switch(o){case"Point":i=nk;break;case"Polygon":i=tk;break;case"LineString":i=bb;break;case"MultiPoint":i=db;break;case"MultiCurve":i=kb;break;case"MultiSurface":i=gb;break;case"MultiGeometry":i=wb;break;default:throw{message:"Unsupported element: "+o,element:n};}if(u=i(n,t),r=st(n,"srsName",ut)||st(n,"srsName"),r){if(r.indexOf(bc)!==0)throw{message:"Unsupported srs name: "+r,element:n};e=r.substring(bc.length),e&&(u.crs={type:"name",properties:{name:"EPSG:"+e}})}return u},il=function(n,t,i,r){var u,o,e,s,f,h,c;switch(i){case wf:u=uk;break;case bf:u=fk;break;case kf:u=ek;break;case df:u=ok;break;case gf:u=sk;break;case ne:u=hk;break;case te:u=lk;break;default:return null}return o=u(n,t,r),e=t.crs,e&&e.type==="name"&&(s=e.properties,f=s&&s.name,f&&f.indexOf("ESPG:")===0&&f.length>5&&(h=f.substring(5),c=si(n,null,"srsName",kc+h),l(o,c))),o},dt=function(n,t,i){return cr(n,ut,wt(kc,t),i)},rl=function(n,t,i){var r=e(t)?t:[];return r=i?ce(r):r,dt(n,"pos",r.join(" "))},ul=function(n,t,i,r){var f=dt(n,t),u,o;if(e(i)){for(u=0,o=i.length;u<o;u++)l(f,rl(n,i[u],r));o===0&&l(f,dt(n,"posList"))}return f},fl=function(n,t,i){return dt(n,"Point",rl(n,t,i))},el=function(n,t,i){return ul(n,"LineString",t,i)},ol=function(n,t,i,r){var u=dt(n,t),f;return e(i)&&i.length>0&&(f=ul(n,"LinearRing",i,r),l(u,f)),u},sl=function(n,t,i){var f=t&&t.length,u=dt(n,"Polygon"),r;if(e(t)&&f>0)for(l(u,ol(n,"exterior",t[0],i)),r=1;r<f;r++)l(u,ol(n,"interior",t[r],i));return u},uk=function(n,t,i){return fl(n,t.coordinates,i)},fk=function(n,t,i){return el(n,t.coordinates,i)},ek=function(n,t,i){return sl(n,t.coordinates,i)},ku=function(n,t,i,r,u,f){var h=r&&r.length,c=dt(n,t),s,o;if(e(r)&&h>0){for(s=dt(n,i),o=0;o<h;o++)l(s,u(n,r[o],f));l(c,s)}return c},ok=function(n,t,i){return ku(n,"MultiPoint","pointMembers",t.coordinates,fl,i)},sk=function(n,t,i){return ku(n,"MultiCurve","curveMembers",t.coordinates,el,i)},hk=function(n,t,i){return ku(n,"MultiSurface","surfaceMembers",t.coordinates,sl,i)},ck=function(n,t,i){return il(n,t,t.type,i)},lk=function(n,t,i){return ku(n,"MultiGeometry","geometryMembers",t.geometries,ck,i)},du="application/xml",ak=uu+"docs.oasis-open.org/odata/",lt=ak+"ns",gu=lt+"/edmx",vk=lt+"/edm",at=lt,nt=lt+"/metadata",pe=lt+"/related/",hl=lt+"/scheme",cl="d",we="m",gt=function(n,t){var i={name:f(n),value:n.value};return i[t?"namespaceURI":"namespace"]=u(n),i},yr=function(n,t){for(var s=[],h=[],c=n.attributes,e,i,o,r=0,l=c.length;r<l;r++)e=c[r],u(e)!==sr&&s.push(gt(e,t));for(i=n.firstChild;i!=null;)i.nodeType===1&&h.push(yr(i,t)),i=i.nextSibling;return o={name:f(n),value:k(n),attributes:s,children:h},o[t?"namespaceURI":"namespace"]=u(n),o},be=function(n){return u(n)===at&&f(n)==="element"},ll=function(n,t){return{type:n,extensions:t}},yk=function(n){var t,i;return b(n,ut)?et:(t=b(n,at),!t)?lr:be(t)&&(i=tw(t,at),i&&be(i))?"Collection()":null},al=function(n){var t=null,i=!1,r=[];return pi(n,function(n){var e=u(n),o=f(n),s=bi(n);if(e===nt){if(o==="null"){i=s.toLowerCase()==="true";return}if(o==="type"){t=s;return}}if(e!==yi&&e!==sr){r.push(gt(n,!0));return}}),{type:!t&&i?lr:t,isNull:i,extensions:r}},vl=function(n){if(u(n)!==at)return null;var e=f(n),t=al(n),o=t.isNull,i=t.type,r=ll(i,t.extensions),s=o?null:yl(n,i,r);return{name:e,value:s,metadata:r}},yl=function(n,t,i){t||(t=yk(n),i.type=t);var r=ie(t);return r||re(t)?pk(n,t,r):ue(t)?pl(n,t):vu(t)?bk(n,t,i):wk(n,t,i)},pk=function(n,t,i){var u=b(n,ut),r=tl(u,i);return r.__metadata={type:t},r},pl=function(n,t){var i=bi(n)||"";switch(t){case cs:return oe(i);case hs:case as:case ys:case bs:case lr:return i;case ls:case ps:case ws:case ks:return s(i);case vs:case ds:return parseFloat(i);case lu:return he(i);case hu:return pu(i);case cu:return se(i)}return i},wk=function(n,t,i){var r={__metadata:{type:t}};return p(n,function(n){var t=vl(n),u=t.name;i.properties=i.properties||{},i.properties[u]=t.metadata,r[u]=t.value}),r},bk=function(n,t,i){var r=[],u=i.elements=[],f=au(t);return p(n,function(n){if(be(n)){var t=al(n),o=t.extensions,i=t.type||f,e=ll(i,o),s=yl(n,i,e);r.push(s),u.push(e)}}),{__metadata:{type:t==="Collection()"?null:t},results:r}},kk=function(n,i){if(u(n)===at){i=rt(n,i);var r=f(n);if(r==="links")return dk(n,i);if(r==="uri")return wl(n,i)}return t},dk=function(n,t){var i=[];return p(n,function(n){f(n)==="uri"&&u(n)===at&&i.push(wl(n,t))}),{results:i}},wl=function(n,t){var i=k(n)||"";return{uri:c(i,t)}},gk=function(n,t){return t===et||t===ht?n&&n.type:t===eh||t===gs?wf:t===oh||t===nh?bf:t===sh||t===th?kf:t===hh||t===ih?te:t===ch||t===rh?ne:t===lh||t===uh?gf:t===ah||t===fh?df:null},bl=function(n,t,i){return cr(n,nt,wt(we,t),i)},ke=function(n,t,i){return si(n,nt,wt(we,t),i)},kl=function(n,t,i){return cr(n,at,wt(cl,t),i)},nd=function(n,t){return t===hu||t===cu||cf(n)?yh(n):t===lu?ph(n):n.toString()},vt=function(n,t){return{element:n,dsv:t}},pr=function(n,t,i,r){var u=i?ke(n,"type",i):null,f=kl(n,t,u);return ou(f,r)},td=function(n,t,i,r){var u=nd(i,r),f=pr(n,t,r,u);return vt(f,"1.0")},id=function(n,t,i,r){var u=ke(n,"null","true"),f=pr(n,t,i,u),e=di(i,r)?"2.0":"1.0";return vt(f,e)},rd=function(n,t,i,r,u,f,o){var c=au(r),a=e(i)?i:i.results,v=r?{type:c}:{},h,s,y,p,w;for(v.properties=u.properties,h=pr(n,t,c?r:null),s=0,y=a.length;s<y;s++)p=a[s],w=de(n,"element",p,v,f,o),l(h,w.element);return vt(h,"4.0")},ud=function(n,t,i,r,u,f,e){var h=pr(n,t,r),a=u.properties||{},v=di(r,e)||{},s="1.0",o;for(o in i)if(o!=="__metadata"){var y=i[o],p=bt(v.property,o),w=a[o]||{},c=de(n,o,y,w,p,e);s=ct(s,c.dsv),l(h,c.element)}return vt(h,s)},fd=function(n,t,i,r,u){var f=gk(i,r),e=il(n,i,f,u),o=pr(n,t,r,e);return vt(o,".0")},de=function(n,t,i,r,u,f){var e=ss(i,r,u),o,s;return yu(i)?td(n,t,i,e||lr):(o=ie(e),o||re(e))?fd(n,t,i,e,o):bh(i,e)?rd(n,t,i,e,r,u,f):gh(i)?null:(s=nc(i,u),s!==null)?null:i===null?id(n,t,e):ud(n,t,i,e,r,u,f)},ed=function(n){if(n&&lf(n)){var t=es();return l(t,kl(t,"uri",n.uri))}},od=function(n,t){if(t){var r=eu(t),i=b(r);if(i)return kk(i)}},sd=function(n,i,r){var u=r.contentType=r.contentType||gi(du);return u&&u.mediaType===du?pf(ed(i)):t};r.xmlHandler=li(od,sd,du,ci);var dl="a",ni=or+"2005/Atom",wr=or+"2007/app",gl=lt+"/edit-media/",na=lt+"/mediaresource/",ta=lt+"/relatedlinks/",ia=["application/atom+xml","application/atomsvc+xml","application/xml"],ra=ia[0],hd=[ni,wr,yi,sr],cd={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},ld=function(n){return cd[n]||n},br=function(n){return!fr(hd,n)},ua=function(n,t,i,r,u){var f;if(u=u||"",f=n["FC_TargetPath"+u],!f)return null;var e=n["FC_SourcePath"+u],s=ld(f),o=r?r+(e?"/"+e:""):e,l=o&&bd(i,t,o),h=n["FC_NsUri"+u]||null,c=n["FC_NsPrefix"+u]||null,a=n["FC_KeepInContent"+u]||"";return f!==s&&(h=ni,c=dl),{contentKind:n["FC_ContentKind"+u],keepInContent:a.toLowerCase()==="true",nsPrefix:c,nsURI:h,propertyPath:o,propertyType:l,entryPath:s}},fa=function(n,t,i){for(var c=[],l,r,f,u,e;n;){for(l=n.FC_SourcePath,r=ua(n,n,t),r&&i(r),f=n.property||[],u=0,e=f.length;u<e;u++)for(var o=f[u],s=0,h="";r=ua(o,n,t,o.name,h);)i(r),s++,h="_"+s;n=kt(n.baseType,t)}return c},nf=function(n){var t=[];return pi(n,function(n){var i=u(n);br(i)&&t.push(gt(n,!0))}),t},ea=function(n){return yr(n,!0)},oa=function(n,t,i){var e=u(n),r=f(n);if(e===wr&&r==="service")return fg(n,t);if(e===ni){if(r==="feed")return ad(n,t,i);if(r==="entry")return aa(n,t,i)}},sa=function(n,t){var r=[],i={extensions:r};return pi(n,function(e){var o=f(e),s=u(e),h=bi(e);if(s===null){if(o==="title"||o==="metadata"){i[o]=h;return}if(o==="target"){i.target=c(h,rt(n,t));return}}br(s)&&r.push(gt(e,!0))}),i},ha=function(n,t,i){var r=i.actions=i.actions||[];r.push(sa(n,t))},ca=function(n,t,i){var r=i.functions=i.functions||[];r.push(sa(n,t))},ad=function(n,t,i){var o=nf(n),r={feed_extensions:o},s=[],e={__metadata:r,results:s};return t=rt(n,t),p(n,function(n){var l=u(n),h=f(n);if(l===nt){if(h==="count"){e.__count=parseInt(k(n),10);return}if(h==="action"){ha(n,t,r);return}if(h==="function"){ca(n,t,r);return}}if(br(l)){o.push(yr(n));return}if(h==="entry"){s.push(aa(n,t,i));return}if(h==="link"){vd(n,e,t);return}if(h==="id"){r.uri=c(k(n),t),r.uri_extensions=nf(n);return}if(h==="title"){r.title=k(n)||"",r.title_extensions=nf(n);return}}),e},vd=function(n,t,i){var r=la(n,i),f=r.href,e=r.rel,o=r.extensions,u=t.__metadata;if(e==="next"){t.__next=f,u.next_extensions=o;return}if(e==="self"){u.self=f,u.self_extensions=o;return}},la=function(n,t){t=rt(n,t);var r=[],i={extensions:r,baseURI:t};if(pi(n,function(n){var s=u(n),e=f(n),o=n.value;if(e==="href"){i.href=c(o,t);return}if(e==="type"||e==="rel"){i[e]=o;return}br(s)&&r.push(gt(n,!0))}),!i.href)throw{error:"href attribute missing on link element",element:n};return i},yd=function(n,i){if(n.indexOf("/")===-1)return i[n];for(var u=n.split("/"),r=0,f=u.length;r<f;r++){if(i===null)return t;if(i=i[u[r]],i===t)return i}return i},pd=function(n,i,r,u){var o,s,f,h,e;if(n.indexOf("/")===-1)i[n]=r,o=n;else{for(s=n.split("/"),f=0,h=s.length-1;f<h;f++){if(e=i[s[f]],e===t)e={},i[s[f]]=e;else if(e===null)return;i=e}o=s[f],i[o]=r}if(u){var c=i.__metadata=i.__metadata||{},l=c.properties=c.properties||{},a=l[o]=l[o]||{};a.type=u}},wd=function(n,t,i){var e=n.propertyPath,r,u,f;n.keepInContent||yd(e,i)===null||(r=gp(t,n.nsURI,n.entryPath),r)&&(u=n.propertyType,f=n.contentKind==="xhtml"?fw(r):pl(r,u||"Edm.String"),pd(e,i,f,u))},bd=function(n,t,i){for(var s=i.split("/"),u,h,f,e,o,r;t;){for(f=t,u=0,h=s.length;u<h;u++){if(e=f.property,!e)break;if(o=bt(e,s[u]),!o)break;if(r=o.type,!r||ue(r))return r||null;if(f=di(r,n),!f)return null}t=kt(t.baseType,n)}return null},aa=function(n,t,i){var r={},e={__metadata:r},o=st(n,"etag",nt),s;return o&&(r.etag=o),t=rt(n,t),p(n,function(n){var s=u(n),o=f(n);if(s===ni){if(o==="id"){kd(n,r,t);return}if(o==="category"){dd(n,r);return}if(o==="content"){gd(n,e,r,t);return}if(o==="link"){ng(n,e,r,t,i);return}return}if(s===nt){if(o==="properties"){pa(n,e,r);return}if(o==="action"){ha(n,t,r);return}if(o==="function"){ca(n,t,r);return}}}),s=kt(r.type,i),fa(s,i,function(t){wd(t,n,e)}),e},kd=function(n,t,i){t.uri=c(k(n),rt(n,i)),t.uri_extensions=nf(n)},dd=function(n,t){if(st(n,"scheme")===hl){if(t.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:n};var i=[];pi(n,function(n){var t=u(n),r=f(n);if(!t){r!=="scheme"&&r!=="term"&&i.push(gt(n,!0));return}br(t)&&i.push(gt(n,!0))}),t.type=st(n,"term"),t.type_extensions=i}},gd=function(n,t,i,r){var e=st(n,"src"),o=st(n,"type");if(e){if(!o)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:n};i.media_src=c(e,rt(n,r)),i.content_type=o}p(n,function(r){if(e)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:n};u(r)===nt&&f(r)==="properties"&&pa(r,t,i)})},ng=function(n,t,i,r,u){var f=la(n,r),e=f.rel,s=f.href,o=f.extensions;if(e==="self"){i.self=s,i.self_link_extensions=o;return}if(e==="edit"){i.edit=s,i.edit_link_extensions=o;return}if(e==="edit-media"){i.edit_media=f.href,i.edit_media_extensions=o,ya(f,i);return}if(e.indexOf(gl)===0){rg(f,t,i);return}if(e.indexOf(na)===0){ug(f,t,i);return}if(e.indexOf(pe)===0){ig(n,f,t,i,u);return}if(e.indexOf(ta)===0){tg(f,i);return}},tg=function(n,t){var r=n.rel.substring(ta.length),i;t.properties=t.properties||{},i=t.properties[r]=t.properties[r]||{},i.associationuri=n.href,i.associationuri_extensions=n.extensions},ig=function(n,t,i,r,u){var e,o=b(n,nt,"inline"),s,h,f,c;o?(s=b(o),h=rt(o,t.baseURI),e=s?oa(s,h,u):null):e={__deferred:{uri:t.href}},f=t.rel.substring(pe.length),i[f]=e,r.properties=r.properties||{},c=r.properties[f]=r.properties[f]||{},c.extensions=t.extensions},rg=function(n,t,i){var o=n.rel.substring(gl.length),f=va(o,t,i),r=f.value,u=f.metadata,e=n.href;r.edit_media=e,r.content_type=n.type,u.edit_media_extensions=n.extensions,r.media_src=r.media_src||e,u.media_src_extensions=u.media_src_extensions||[],ya(n,r)},ug=function(n,t,i){var f=n.rel.substring(na.length),r=va(f,t,i),u=r.value,e=r.metadata;u.media_src=n.href,e.media_src_extensions=n.extensions,u.content_type=n.type},va=function(n,t,i){i.properties=i.properties||{};var u=i.properties[n],r=t[n]&&t[n].__mediaresource;return r||(r={},t[n]={__mediaresource:r},i.properties[n]=u={}),{value:r,metadata:u}},ya=function(n,t){for(var r=n.extensions,i=0,u=r.length;i<u;i++)if(r[i].namespaceURI===nt&&r[i].name==="etag"){t.media_etag=r[i].value,r.splice(i,1);return}},pa=function(n,t,i){p(n,function(n){var r=vl(n),u,f;r&&(u=r.name,f=i.properties=i.properties||{},f[u]=r.metadata,t[u]=r.value)})},fg=function(n,t){var i=[],r=[];if(t=rt(n,t),p(n,function(n){if(u(n)===wr&&f(n)==="workspace"){i.push(eg(n,t));return}r.push(yr(n))}),i.length===0)throw{message:"Invalid AtomPub service document: No workspace element found.",element:n};return{workspaces:i,extensions:r}},eg=function(n,i){var e=[],o=[],r;return i=rt(n,i),p(n,function(n){var s=u(n),h=f(n);if(s===ni&&h==="title"){if(r!==t)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:n};r=k(n);return}if(s===wr){h==="collection"&&e.push(og(n,i));return}o.push(ea(n))}),{title:r||"",collections:e,extensions:o}},og=function(n,i){var r=st(n,"href"),o,e;if(!r)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:n};if(i=rt(n,i),r=c(r,rt(n,i)),o=[],p(n,function(i){var r=u(i),s=f(i);if(r===ni){if(s==="title"){if(e!==t)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:i};e=k(i)}return}r!==wr&&o.push(ea(n))}),!e)throw{message:"Invalid AtomPub service document: collection has no title element",element:n};return{title:e,href:r,extensions:o}},ti=function(n,t,i){return cr(n,ni,wt(dl,t),i)},nr=function(n,t,i){return si(n,null,t,i)},sg=function(n){var t,e,i,o,r;if(n.childNodes.length>0)return!1;for(t=!0,e=n.attributes,i=0,o=e.length;i<o&&t;i++)r=e[i],t=t&&wp(r)||u(r)==nt&&f(r)==="type";return t},hg=function(n,t,i,r,u){var s=null,e=null,f=null,o="",h;return i!=="deferred"?(s=nr(n,"type","application/atom+xml;type="+i),e=bl(n,"inline"),r&&(o=r.__metadata&&r.__metadata.uri||"",f=wa(n,r,u)||ge(n,r,u),l(e,f.element))):o=r.__deferred.uri,h=ti(n,"link",[nr(n,"href",o),nr(n,"rel",c(t,pe)),s,e]),vt(h,f?f.dsv:"1.0")},cg=function(n,t,i,r,u,f){var e,o;return gh(i)?null:(e=de(n,t,i,r,u,f),e||(o=nc(i,u),e=hg(n,t,o,i,f)),e)},lg=function(n,t,i,r){var u=us(i,at,r.propertyPath),l=u&&wi(u,"null",nt),o,s="1.0",f,e,h,c;if(l&&l.value==="true")return s;if(u&&(o=k(u)||"",!r.keepInContent))for(s="2.0",f=u.parentNode,e=f,f.removeChild(u);e!==i&&sg(e);)f=e.parentNode,f.removeChild(e),e=f;return(h=uw(n,t,r.nsURI,r.nsPrefix,r.entryPath),h.nodeType===2)?(h.value=o,s):(c=r.contentKind,ou(h,[c&&si(n,null,"type",c),c==="xhtml"?iw(n,o):o]),s)},ge=function(n,t,i){var e=t.__metadata||{},b=e.properties||{},y=e.etag,p=e.uri,s=e.type,o=kt(s,i),h=bl(n,"properties"),c=ti(n,"entry",[ti(n,"author",ti(n,"name")),y&&ke(n,"etag",y),p&&ti(n,"id",p),s&&ti(n,"category",[nr(n,"term",s),nr(n,"scheme",hl)]),ti(n,"content",[nr(n,"type","application/xml"),h])]),f="1.0",r,v,w;for(r in t)if(r!=="__metadata"){var k=b[r]||{},d=o&&(bt(o.property,r)||bt(o.navigationProperty,r)),a=cg(n,r,t[r],k,d,i);a&&(v=a.element,w=u(v)===ni?c:h,l(w,v),f=ct(f,a.dsv))}return fa(o,i,function(t){var i=lg(n,c,h,t);f=ct(f,i)}),vt(c,f)},wa=function(n,t,i){var f=e(t)?t:t.results,r,o,u,h,s;if(!f)return null;for(r="1.0",o=ti(n,"feed"),u=0,h=f.length;u<h;u++)s=ge(n,f[u],i),l(o,s.element),r=ct(r,s.dsv);return vt(o,r)},ag=function(n,t){var u,i,r,f;return n&&(u=ar(n)&&wa||lf(n)&&ge,u&&(i=es(),r=u(i,n,t),r))?(f=r.element,ou(f,[os(i,nt,we),os(i,at,cl)]),vt(l(i,f),r.dsv)):null},vg=function(n,t,i){if(t){var u=eu(t),r=b(u);if(r)return oa(r,null,i.metadata)}},yg=function(n,t,i){var u=i.contentType=i.contentType||gi(ra),r;if(u&&u.mediaType===ra&&(r=ag(t,i.metadata),r))return i.dataServiceVersion=ct(i.dataServiceVersion||"1.0",r.dsv),pf(r.element)};r.atomHandler=li(vg,yg,ia.join(","),ci);var i=function(n,t,i,r){return{attributes:n,elements:t,text:i||!1,ns:r}},tt={elements:{Annotations:i(["Target","Qualifier"],["TypeAnnotation*","ValueAnnotation*"]),Association:i(["Name"],["End*","ReferentialConstraint","TypeAnnotation*","ValueAnnotation*"]),AssociationSet:i(["Name","Association"],["End*","TypeAnnotation*","ValueAnnotation*"]),Binary:i(null,null,!0),Bool:i(null,null,!0),Collection:i(null,["String*","Int*","Float*","Decimal*","Bool*","DateTime*","DateTimeOffset*","Guid*","Binary*","Time*","Collection*","Record*"]),CollectionType:i(["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"],["CollectionType","ReferenceType","RowType","TypeRef"]),ComplexType:i(["Name","BaseType","Abstract"],["Property*","TypeAnnotation*","ValueAnnotation*"]),DateTime:i(null,null,!0),DateTimeOffset:i(null,null,!0),Decimal:i(null,null,!0),DefiningExpression:i(null,null,!0),Dependent:i(["Role"],["PropertyRef*"]),Documentation:i(null,null,!0),End:i(["Type","Role","Multiplicity","EntitySet"],["OnDelete"]),EntityContainer:i(["Name","Extends"],["EntitySet*","AssociationSet*","FunctionImport*","TypeAnnotation*","ValueAnnotation*"]),EntitySet:i(["Name","EntityType"],["TypeAnnotation*","ValueAnnotation*"]),EntityType:i(["Name","BaseType","Abstract","OpenType"],["Key","Property*","NavigationProperty*","TypeAnnotation*","ValueAnnotation*"]),EnumType:i(["Name","UnderlyingType","IsFlags"],["Member*"]),Float:i(null,null,!0),Function:i(["Name","ReturnType"],["Parameter*","DefiningExpression","ReturnType","TypeAnnotation*","ValueAnnotation*"]),FunctionImport:i(["Name","ReturnType","EntitySet","IsSideEffecting","IsComposable","IsBindable","EntitySetPath"],["Parameter*","ReturnType","TypeAnnotation*","ValueAnnotation*"]),Guid:i(null,null,!0),Int:i(null,null,!0),Key:i(null,["PropertyRef*"]),LabeledElement:i(["Name"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),Member:i(["Name","Value"]),NavigationProperty:i(["Name","Relationship","ToRole","FromRole","ContainsTarget"],["TypeAnnotation*","ValueAnnotation*"]),Null:i(null,null),OnDelete:i(["Action"]),Path:i(null,null,!0),Parameter:i(["Name","Type","Mode","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","SRID"],["CollectionType","ReferenceType","RowType","TypeRef","TypeAnnotation*","ValueAnnotation*"]),Principal:i(["Role"],["PropertyRef*"]),Property:i(["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","CollectionKind","SRID"],["CollectionType","ReferenceType","RowType","TypeAnnotation*","ValueAnnotation*"]),PropertyRef:i(["Name"]),PropertyValue:i(["Property","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ReferenceType:i(["Type"]),ReferentialConstraint:i(null,["Principal","Dependent"]),ReturnType:i(["ReturnType","Type","EntitySet"],["CollectionType","ReferenceType","RowType"]),RowType:i(["Property*"]),String:i(null,null,!0),Schema:i(["Namespace","Alias"],["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*","ValueTerm*","Annotations*"]),Time:i(null,null,!0),TypeAnnotation:i(["Term","Qualifier"],["PropertyValue*"]),TypeRef:i(["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]),Using:i(["Namespace","Alias"]),ValueAnnotation:i(["Term","Qualifier","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ValueTerm:i(["Name","Type"],["TypeAnnotation*","ValueAnnotation*"]),Edmx:i(["Version"],["DataServices","Reference*","AnnotationsReference*"],!1,gu),DataServices:i(null,["Schema*"],!1,gu)}},ba=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];tt.elements.Property.attributes=tt.elements.Property.attributes.concat(ba),tt.elements.EntityType.attributes=tt.elements.EntityType.attributes.concat(ba),tt.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:gu},tt.elements.DataServices={elements:["Schema*"],ns:gu},tt.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),tt.elements.Property.attributes.push("m:MimeType"),tt.elements.FunctionImport.attributes.push("m:HttpMethod"),tt.elements.FunctionImport.attributes.push("m:IsAlwaysBindable"),tt.elements.EntityType.attributes.push("m:HasStream"),tt.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var ka=function(n){if(!n)return n;if(n.length>1){var t=n.substr(0,2);return t===t.toUpperCase()?n:n.charAt(0).toLowerCase()+n.substr(1)}return n.charAt(0).toLowerCase()},pg=function(n,t){var r,u,e,i,f,o;if(t==="Documentation")return{isArray:!0,propertyName:"documentation"};if(r=n.elements,!r)return null;for(u=0,e=r.length;u<e;u++)if(i=r[u],f=!1,i.charAt(i.length-1)==="*"&&(f=!0,i=i.substr(0,i.length-1)),t===i)return o=ka(i),{isArray:f,propertyName:o};return null},wg=/^(m:FC_.*)_[0-9]+$/,da=function(n){return n===vk},no=function(n){var o=f(n),e=u(n),i=tt.elements[o];if(!i)return null;if(i.ns){if(e!==i.ns)return null}else if(!da(e))return null;var t={},r=[],s=i.attributes||[];return pi(n,function(n){var c=f(n),e=u(n),l=n.value,i,o,h;e!==sr&&(i=null,o=!1,da(e)||e===null?i="":e===nt&&(i="m:"),i!==null&&(i+=c,h=wg.exec(i),h&&(i=h[1]),fr(s,i)&&(o=!0,t[ka(c)]=l)),o||r.push(gt(n)))}),p(n,function(n){var o=f(n),u=pg(i,o),e;u?u.isArray?(e=t[u.propertyName],e||(e=[],t[u.propertyName]=e),e.push(no(n))):t[u.propertyName]=no(n):r.push(yr(n))}),i.text&&(t.text=k(n)),r.length&&(t.extensions=r),t},ga=function(n,i){var r=eu(i),u=b(r);return no(u)||t};r.metadataHandler=li(ga,null,du,ci);var nv="o",to="f",tv="p",iv="c",rv="s",uv="l",bg="odata",ii=bg+".",kg="@"+ii+"bind",io=ii+"metadata",fv=ii+"navigationLinkUrl",tr=ii+"type",tf={readLink:"self",editLink:"edit",nextLink:"__next",mediaReadLink:"media_src",mediaEditLink:"edit_media",mediaContentType:"content_type",mediaETag:"media_etag",count:"__count",media_src:"mediaReadLink",edit_media:"mediaEditLink",content_type:"mediaContentType",media_etag:"mediaETag",url:"uri"},h={metadata:"odata.metadata",count:"odata.count",next:"odata.nextLink",id:"odata.id",etag:"odata.etag",read:"odata.readLink",edit:"odata.editLink",mediaRead:"odata.mediaReadLink",mediaEdit:"odata.mediaEditLink",mediaEtag:"odata.mediaETag",mediaContentType:"odata.mediaContentType",actions:"odata.actions",functions:"odata.functions",navigationUrl:"odata.navigationLinkUrl",associationUrl:"odata.associationLinkUrl",type:"odata.type"},dg=function(n){if(n.indexOf(".")>0){var t=n.indexOf("@"),r=t>-1?n.substring(0,t):null,i=n.substring(t+1);return{target:r,name:i,isOData:i.indexOf(ii)===0}}return null},ro=function(n,t,i,r,u){return d(t)&&t[tr]||i&&i[n+"@"+tr]||r&&r.type||ww(r,u)||null},uo=function(n,t){return t?bt(t.property,n)||bt(t.navigationProperty,n):null},ev=function(n){return d(n)&&ii+"id"in n},gg=function(n,t,i){if(!!t[n+"@"+fv]||i&&i.relationship)return!0;var r=e(t[n])?t[n][0]:t[n];return ev(r)},fo=function(n){return ue(n)||ie(n)||re(n)},ri=function(n,t,i,r,u){var f,e;for(f in n)if(f.indexOf(".")>0&&f.charAt(0)!=="#"&&(e=dg(f),e)){var c=e.name,o=e.target,s=null,h=null;o&&(s=uo(o,r),h=ro(o,n[o],n,s,u)),e.isOData?nn(c,o,h,n[f],n,t,i):t[f]=n[f]}return t},nn=function(n,t,i,r,u,f,e){var o=n.substring(ii.length);switch(o){case"navigationLinkUrl":fn(o,t,i,r,u,f,e);return;case"nextLink":case"count":rn(o,t,r,f,e);return;case"mediaReadLink":case"mediaEditLink":case"mediaContentType":case"mediaETag":un(o,t,i,r,f,e);return;default:tn(o,t,r,f,e);return}},tn=function(n,t,i,r,u){var f=r.__metadata=r.__metadata||{},e=tf[n]||n,s,o;if(n==="editLink"){f.uri=c(i,u),f[e]=f.uri;return}if((n==="readLink"||n==="associationLinkUrl")&&(i=c(i,u)),t){if(s=f.properties=f.properties||{},o=s[t]=s[t]||{},n==="type"){o[e]=o[e]||i;return}o[e]=i;return}f[e]=i},rn=function(n,t,i,r,u){var f=tf[n],e=t?r[t]:r;e[f]=n==="nextLink"?c(i,u):i},un=function(n,t,i,r,u,f){var e=u.__metadata=u.__metadata||{},h=tf[n],o,s;if((n==="mediaReadLink"||n==="mediaEditLink")&&(r=c(r,f)),t){o=e.properties=e.properties||{},s=o[t]=o[t]||{},s.type=s.type||i,u.__metadata=e,u[t]=u[t]||{__mediaresource:{}},u[t].__mediaresource[h]=r;return}e[h]=r},fn=function(n,t,i,r,u,f,e){var s=f.__metadata=f.__metadata||{},h=s.properties=s.properties||{},o=h[t]=h[t]||{},l=c(r,e);if(u.hasOwnProperty(t)){o.navigationLinkUrl=l;return}f[t]={__deferred:{uri:l}},o.type=o.type||i},eo=function(n,t,i,r,u,f,o){if(typeof n=="string")return en(n,t,o);if(!fo(t)){if(e(n))return ov(n,t,i,r,f,o);if(d(n))return on(n,t,i,r,f,o)}return n},en=function(n,t,i){switch(t){case lu:return he(n);case hu:return pu(n,!1);case cu:return se(n,!1)}return i?pu(n,!0)||se(n,!0)||n:n},ov=function(n,t,i,r,u,f){for(var a=au(t),o=[],h=[],e=0,c=n.length;e<c;e++){var s=ro(null,n[e])||a,l={type:s},v=eo(n[e],s,l,r,null,u,f);fo(s)||yu(n[e])||o.push(l),h.push(v)}return o.length>0&&(i.elements=o),{__metadata:{type:t},results:h}},on=function(n,t,i,r,u,f){var e=rf(n,{type:t},r,u,f),o=e.__metadata,s=o.properties;return s&&(i.properties=s,delete o.properties),e},sn=function(n,t,i,r,u){return e(n)?hv(n,t,i,r,u):d(n)?rf(n,t,i,r,u):null},rf=function(n,i,r,u,f){var d,v,g,o,y,h,c,nt;i=i||{};var l=n[tr]||i.type||null,s=kt(l,u),k=!0;s||(k=!1,s=di(l,u));var p={type:l},a={__metadata:p},w={},e;if(k&&s&&i.entitySet&&i.contentTypeOdata=="minimalmetadata"){for(d=r.substring(0,r.lastIndexOf("$metadata")),e=null,s.key||(e=s);!!e&&!e.key&&e.baseType;)e=kt(e.baseType,u);(s.key||!!e&&e.key)&&(v=s.key?cv(n,s):cv(n,e),v&&(g={key:v,entitySet:i.entitySet,functionImport:i.functionImport,containerName:i.containerName},hn(n,g,l,d,s,e)))}for(o in n)if(o.indexOf("#")===0)sv(o.substring(1),n[o],a,r,u);else if(o.indexOf(".")===-1){for(p.properties||(p.properties=w),y=n[o],h=h=uo(o,s),e=s;!!s&&h===null&&e.baseType;)e=kt(e.baseType,u),h=h=uo(o,e);var tt=gg(o,n,h),b=ro(o,y,n,h,u),it=w[o]=w[o]||{type:b};tt?(c={},i.entitySet!==t&&(nt=bw(h,i.entitySet.name,u),c=kw(nt,u)),c.contentTypeOdata=i.contentTypeOdata,c.kind=i.kind,c.type=b,a[o]=sn(y,c,r,u,f)):a[o]=eo(y,b,it,r,h,u,f)}return ri(n,a,r,s,u)},sv=function(n,t,i,r,u){var f,s,g,nt;if(n&&(e(t)||d(t))){var l=!1,h=n.lastIndexOf("."),a=n.substring(h+1),v=h>-1?n.substring(0,h):"",y=a===n||v.indexOf(".")===-1?tc(u):ic(v,u);y&&(f=pw(y.functionImport,a),f&&!!f.isSideEffecting&&(l=!oe(f.isSideEffecting)));for(var p=i.__metadata,w=l?"functions":"actions",tt=c(n,r),b=e(t)?t:[t],o=0,k=b.length;o<k;o++)s=b[o],s&&(g=p[w]=p[w]||[],nt={metadata:tt,title:s.title,target:c(s.target,r)},g.push(nt))}},hv=function(n,t,i,r,u){for(var h=e(n)?n:n.value,c=[],l,f,s,o=0,a=h.length;o<a;o++)l=rf(h[o],t,i,r,u),c.push(l);if(f={results:c},d(n)){for(s in n)s.indexOf("#")===0&&(f.__metadata=f.__metadata||{},sv(s.substring(1),n[s],f,i,r));f=ri(n,f,i)}return f},cv=function(n,t){var r,i=t.key.propertyRef,f,e,u;if(r="(",i.length==1)f=bt(t.property,i[0].name).type,r+=oo(n[i[0].name],f);else for(e=!0,u=0;u<i.length;u++)e?e=!1:r+=",",f=bt(t.property,i[u].name).type,r+=i[u].name+"="+oo(n[i[u].name],f);return r+=")"},hn=function(n,t,i,r,u,f){var o=n[h.id]||n[h.read]||n[h.edit]||t.entitySet.name+t.key,e;n[h.id]=r+o,n[h.edit]||(n[h.edit]=t.entitySet.name+t.key,t.entitySet.entityType!=i&&(n[h.edit]+="/"+i)),n[h.read]=n[h.read]||n[h.edit],n[h.etag]||(e=cn(n,u,f),!e||(n[h.etag]=e)),yn(n,u,f),ln(n,u,f),vn(n,t)},cn=function(n,t,i){for(var u="",f,r=0;t.property&&r<t.property.length;r++)f=t.property[r],u=lv(n,u,f);if(i)for(r=0;i.property&&r<i.property.length;r++)f=i.property[r],u=lv(n,u,f);return u.length>0?u+'"':null},lv=function(n,t,i){return i.concurrencyMode=="Fixed"&&(t+=t.length>0?",":'W/"',t+=n[i.name]!==null?oo(n[i.name],i.type):"null"),t},ln=function(n,i,r){for(var s="@odata.navigationLinkUrl",c="@odata.associationLinkUrl",u,e,o,f=0;i.navigationProperty&&f<i.navigationProperty.length;f++)u=i.navigationProperty[f].name,e=u+s,n[e]===t&&(n[e]=n[h.edit]+"/"+encodeURIComponent(u)),o=u+c,n[o]===t&&(n[o]=n[h.edit]+"/$links/"+encodeURIComponent(u));if(r&&r.navigationProperty)for(f=0;f<r.navigationProperty.length;f++)u=r.navigationProperty[f].name,e=u+s,n[e]===t&&(n[e]=n[h.edit]+"/"+encodeURIComponent(u)),o=u+c,n[o]===t&&(n[o]=n[h.edit]+"/$links/"+encodeURIComponent(u))},oo=function(n,t){n=""+an(n,t),n=encodeURIComponent(n.replace("'","''"));switch(t){case"Edm.Binary":return"X'"+n+"'";case"Edm.DateTime":return"datetime'"+n+"'";case"Edm.DateTimeOffset":return"datetimeoffset'"+n+"'";case"Edm.Decimal":return n+"M";case"Edm.Guid":return"guid'"+n+"'";case"Edm.Int64":return n+"L";case"Edm.Float":return n+"f";case"Edm.Double":return n+"D";case"Edm.Geography":return"geography'"+n+"'";case"Edm.Geometry":return"geometry'"+n+"'";case"Edm.Time":return"time'"+n+"'";case"Edm.String":return"'"+n+"'";default:return n}},an=function(n,t){switch(t){case"Edm.Binary":return hp(n);default:return n}},vn=function(n,i){for(var u=i.functionImport||[],f,r=0;r<u.length;r++)u[r].isBindable&&u[r].parameter[0]&&u[r].parameter[0].type==i.entitySet.entityType&&(f="#"+i.containerName+"."+u[r].name,n[f]==t&&(n[f]={title:u[r].name,target:n[h.edit]+"/"+u[r].name}))},yn=function(n,t,i){(t.hasStream||i&&i.hasStream)&&(n[h.mediaEdit]=n[h.mediaEdit]||n[h.mediaEdit]+"/$value",n[h.mediaRead]=n[h.mediaRead]||n[h.mediaEdit])},pn=function(n,t,i,r){var u={type:t},f=eo(n.value,t,u,i,null,null,r);return ri(n,{__metadata:u,value:f},i)},wn=function(n,t,i,r,u){var f={},e=ov(n.value,t,f,i,r,u);return g(e.__metadata,f),ri(n,e,i)},bn=function(n,t){var r=n.value,u,i,f,o;if(!e(r))return av(n,t);for(u=[],i=0,f=r.length;i<f;i++)u.push(av(r[i],t));return o={results:u},ri(n,o,t)},av=function(n,t){var i={uri:c(n.url,t)},u,r;return i=ri(n,i,t),u=i.__metadata||{},r=u.properties||{},uf(r.url),iu(r,"url","uri"),i},uf=function(n){n&&delete n.type},kn=function(n,t){var o=n.value,s=[],h=ri(n,{collections:s},t),e=h.__metadata||{},i=e.properties||{},u,l,f,r;for(uf(i.value),iu(i,"value","collections"),u=0,l=o.length;u<l;u++)f=o[u],r={title:f.name,href:c(f.url,t)},r=ri(f,r,t),e=r.__metadata||{},i=e.properties||{},uf(i.name),uf(i.url),iu(i,"name","title"),iu(i,"url","href"),s.push(r);return{workspaces:[h]}},ui=function(n,t){return{kind:n,type:t||null}},dn=function(n,t,i){var f=n[io],s,v,o,y,l,r,p,h,c,w,b,u,k;if(!f||typeof f!="string")return null;if(s=f.lastIndexOf("#"),s===-1)return ui(rv);if(v=f.indexOf("@Element",s),o=v-1,o<0&&(o=f.indexOf("?",s),o===-1&&(o=f.length)),y=f.substring(s+1,o),y.indexOf("/$links/")>0)return ui(uv);if(l=y.split("/"),l.length>=0){if(r=l[0],p=l[1],fo(r))return ui(tv,r);if(vu(r))return ui(iv,r);if(h=p,!p){var d=r.lastIndexOf("."),g=r.substring(d+1),a=g===r?tc(t):ic(r.substring(0,d),t);a&&(c=yw(a.entitySet,g),w=a.functionImport,b=a.name,h=!c?null:c.entityType)}return v>0?(u=ui(nv,h),u.entitySet=c,u.functionImport=w,u.containerName=b,u):h?(u=ui(to,h),u.entitySet=c,u.functionImport=w,u.containerName=b,u):e(n.value)&&!di(r,t)&&(k=n.value[0],!yu(k)&&(ev(k)||!i))?ui(to,null):ui(nv,r)}return null},gn=function(n,t,i,r,u){var e,f,o;if(!d(n))return n;if(u=u||"minimalmetadata",e=n[io],f=dn(n,t,r),ot(f)&&(f.contentTypeOdata=u),o=null,f){delete n[io],o=f.type;switch(f.kind){case to:return hv(n,f,e,t,i);case iv:return wn(n,o,e,t,i);case tv:return pn(n,o,e,i);case rv:return kn(n,e);case uv:return bn(n,e)}}return rf(n,f,e,t,i)},vv=["type","etag","media_src","edit_media","content_type","media_etag"],yv=function(n,t){var u=/\/\$links\//,i={},r=n.__metadata,f=t&&u.test(t.request.requestUri);return so(n,r&&r.properties,i,f),i},ntt=function(n,t){var i,u,r,f;if(n)for(i=0,u=vv.length;i<u;i++)r=vv[i],f=ii+(tf[r]||r),kr(f,null,n[r],t)},so=function(n,t,i,r){var u,f;for(u in n)f=n[u],u==="__metadata"?ntt(f,i):u.indexOf(".")===-1?r&&u==="uri"?itt(f,i):ttt(u,f,t,i,r):i[u]=f},ttt=function(n,i,r,u){var e=r&&r[n]||{properties:t,type:t},f=ss(i,e);if(yu(i)||!i){kr(tr,n,f,u),u[n]=i;return}if(ar(i,f)||dh(i)){ftt(n,i,u);return}if(!f&&kh(i)){rtt(n,i,u);return}if(bh(i,f)){au(f)&&kr(tr,n,f,u),utt(n,i,u);return}u[n]={},kr(tr,null,f,u[n]),so(i,e.properties,u[n])},itt=function(n,t){t.url=n},rtt=function(n,t,i){kr(fv,n,t.__deferred.uri,i)},utt=function(n,t,i){i[n]=[];var r=e(t)?t:t.results;so(r,null,i[n])},ftt=function(n,t,i){if(ar(t)){i[n]=[];for(var u=e(t)?t:t.results,r=0,f=u.length;r<f;r++)pv(n,u[r],!0,i);return}pv(n,t,!1,i)},pv=function(n,t,i,r){var f=t.__metadata&&t.__metadata.uri,u;if(f){ett(n,f,i,r);return}if(u=yv(t),i){r[n].push(u);return}r[n]=u},ett=function(n,t,i,r){var u=n+kg;if(i){r[u]=r[u]||[],r[u].push(t);return}r[u]=t},kr=function(n,i,r,u){r!==t&&(i?u[i+"@"+n]=r:u[n]=r)},wv="application/json",bv=gi(wv),kv=function(n){var r=[],t,i,u;for(t in n)for(i=0,u=n[t].length;i<u;i++)r.push(g({metadata:t},n[t][i]));return r},ott=function(n,t,i,r){var c,f,l,u,o,s,v,e,h,a;if(n&&typeof n=="object")if(f=n.__metadata,f&&(f.actions&&(f.actions=kv(f.actions)),f.functions&&(f.functions=kv(f.functions)),c=f&&f.type),l=kt(c,t)||di(c,t),l){if(o=l.property,o)for(s=0,v=o.length;s<v;s++)if(e=o[s],h=e.name,u=n[h],e.type==="Edm.DateTime"||e.type==="Edm.DateTimeOffset"){if(u){if(u=i(u),!u)throw{message:"Invalid date/time value"};n[h]=u}}else e.type==="Edm.Time"&&(n[h]=he(u))}else if(r)for(a in n)u=n[a],typeof u=="string"&&(n[a]=i(u)||u);return n},dv=function(n){if(n){var t=n.properties.odata;return t==="nometadata"||t==="minimalmetadata"||t==="fullmetadata"}return!1},stt=function(n,t){for(var u={collections:[]},r,e,i=0,f=n.EntitySets.length;i<f;i++)r=n.EntitySets[i],e={title:r,href:c(r,t)},u.collections.push(e);return{workspaces:[u]}},htt=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,ctt=function(n){var t,i;return n<0?(t="-",n=-n):t="+",i=Math.floor(n/60),n=n-60*i,t+a(i,2)+":"+a(n,2)},ltt=function(n){var i=n&&htt.exec(n),t,r,u;if(i&&(t=new Date(s(i[1])),i[2]&&(r=s(i[3]),i[2]==="-"&&(r=-r),u=t.getUTCMinutes(),t.setUTCMinutes(u-r),t.__edmType="Edm.DateTimeOffset",t.__offset=ctt(r)),!isNaN(t.valueOf())))return t},att=function(t,i,r){var f=it(r.recognizeDates,t.recognizeDates),h=it(r.inferJsonLightFeedAsObject,t.inferJsonLightFeedAsObject),e=r.metadata,o=r.dataServiceVersion,s=ltt,u=typeof i=="string"?n.JSON.parse(i):i;if(ct("4.0",o)===o){if(dv(r.contentType))return gn(u,e,f,h,r.contentType.properties.odata);s=pu}return u=tb(u.d,function(n,t){return ott(t,e,s,f)}),u=wtt(u,r.dataServiceVersion),ptt(u,r.response.requestUri)},gv=function(t){var i,r=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return yh(this)},i=n.JSON.stringify(t,ytt)}finally{Date.prototype.toJSON=r}return i},vtt=function(n,i,r){var e=r.dataServiceVersion||"1.0",o=it(r.useJsonLight,n.useJsonLight),u=r.contentType=r.contentType||bv,f;return u&&u.mediaType===bv.mediaType?(f=i,o||dv(u))?(r.dataServiceVersion=ct(e,"4.0"),f=yv(i,r),gv(f)):(ct("4.0",e)===e&&(u.properties.odata="verbose",r.contentType=u),gv(f)):t},ytt=function(n,t){return t&&t.__edmType==="Edm.Time"?ph(t):t},ptt=function(n,t){var i=d(n)&&!n.__metadata&&e(n.EntitySets);return i?stt(n,t):n},wtt=function(n,t){return t&&t.lastIndexOf(";")===t.length-1&&(t=t.substr(0,t.length-1)),t&&t!=="1.0"||e(n)&&(n={results:n}),n},ff=li(att,vtt,wv,ci);ff.recognizeDates=!1,ff.useJsonLight=!1,ff.inferJsonLightFeedAsObject=!1,r.jsonHandler=ff;var dr="multipart/mixed",btt=/^HTTP\/1\.\d (\d{3}) (.*)$/i,ktt=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,ho=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)},ny=function(n){return n+ho()+"-"+ho()+"-"+ho()},ty=function(n){return n.handler.partHandler},iy=function(n){var t=n.boundaries;return t[t.length-1]},dtt=function(n,t,i){var r=i.contentType.properties.boundary;return{__batchResponses:ry(t,{boundaries:[r],handlerContext:i})}},gtt=function(n,t,i){var r=i.contentType=i.contentType||gi(dr);if(r.mediaType===dr)return nit(t,i)},ry=function(n,t){var f="--"+iy(t),u,o,s,r,e,i;for(ef(n,t,f),ir(n,t),u=[];o!=="--"&&t.position<n.length;){if(s=uy(n,t),r=gi(s["Content-Type"]),r&&r.mediaType===dr){t.boundaries.push(r.properties.boundary);try{e=ry(n,t)}catch(h){h.response=fy(n,t,f),e=[h]}u.push({__changeResponses:e}),t.boundaries.pop(),ef(n,t,"--"+iy(t))}else{if(!r||r.mediaType!=="application/http")throw{message:"invalid MIME part type "};ir(n,t),i=fy(n,t,f);try{i.statusCode>=200&&i.statusCode<=299?ty(t.handlerContext).read(i,t.handlerContext):i={message:"HTTP request failed",response:i}}catch(h){i=h}u.push(i)}o=n.substr(t.position,2),ir(n,t)}return u},uy=function(n,t){var r={},i,u,f;do f=t.position,u=ir(n,t),i=ktt.exec(u),i!==null?r[i[1]]=i[2]:t.position=f;while(u&&i);return ee(r),r},fy=function(n,t,i){var o=t.position,r=btt.exec(ir(n,t)),u,f,e;return r?(u=r[1],f=r[2],e=uy(n,t),ir(n,t)):t.position=o,{statusCode:u,statusText:f,headers:e,body:ef(n,t,"\r\n"+i)}},ir=function(n,t){return ef(n,t,"\r\n")},ef=function(n,t,i){var u=t.position||0,r=n.length;if(i){if(r=n.indexOf(i,u),r===-1)return null;t.position=r+i.length}else t.position=r;return n.substring(u,r)},nit=function(n,t){var o;if(!lw(n))throw{message:"Data is not a batch object."};for(var r=ny("batch_"),f=n.__batchRequests,u="",i=0,e=f.length;i<e;i++)u+=of(r,!1)+ey(f[i],t);return u+=of(r,!0),o=t.contentType.properties,o.boundary=r,u},of=function(n,t){var i="\r\n--"+n;return t&&(i+="--"),i+"\r\n"},ey=function(n,t,i){var s=n.__changeRequests,r,f,o,h,u;if(e(s)){if(i)throw{message:"Not Supported: change set nested in other change set"};for(f=ny("changeset_"),r="Content-Type: "+dr+"; boundary="+f+"\r\n",o=0,h=s.length;o<h;o++)r+=of(f,!1)+ey(s[o],t,!0);r+=of(f,!0)}else r="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n",u=g({},t),u.handler=li,u.request=n,u.contentType=null,oc(n,ty(t),u),r+=tit(n);return r},tit=function(n){var t=(n.method?n.method:"GET")+" "+n.requestUri+" HTTP/1.1\r\n",i;for(i in n.headers)n.headers[i]&&(t=t+i+": "+n.headers[i]+"\r\n");return t+="\r\n",n.body&&(t+=n.body),t};r.batchHandler=li(dtt,gtt,dr,ci),co=[r.jsonHandler,r.atomHandler,r.xmlHandler,r.textHandler],lo=function(n,t,i){for(var r=0,u=co.length;r<u&&!co[r][n](t,i);r++);if(r===u)throw{message:"no handler for data"};},r.defaultSuccess=function(t){n.alert(n.JSON.stringify(t))},r.defaultError=ru,r.defaultHandler={read:function(n,t){n&&ot(n.body)&&n.headers["Content-Type"]&&lo("read",n,t)},write:function(n,t){lo("write",n,t)},maxDataServiceVersion:ci,accept:"application/atomsvc+xml;q=0.8, application/json;odata.metadata=full;q=0.7, application/json;q=0.5, */*;q=0.1"},r.defaultMetadata=[],r.read=function(n,t,i,u,f,e){var o;return o=n instanceof String||typeof n=="string"?{requestUri:n}:n,r.request(o,t,i,u,f,e)},r.request=function(n,t,i,u,f,e){t=t||r.defaultSuccess,i=i||r.defaultError,u=u||r.defaultHandler,f=f||r.defaultHttpClient,e=e||r.defaultMetadata,n.recognizeDates=it(n.recognizeDates,r.jsonHandler.recognizeDates),n.callbackParameterName=it(n.callbackParameterName,r.defaultHttpClient.callbackParameterName),n.formatQueryString=it(n.formatQueryString,r.defaultHttpClient.formatQueryString),n.enableJsonpCallback=it(n.enableJsonpCallback,r.defaultHttpClient.enableJsonpCallback),n.useJsonLight=it(n.useJsonLight,r.jsonHandler.enableJsonpCallback),n.inferJsonLightFeedAsObject=it(n.inferJsonLightFeedAsObject,r.jsonHandler.inferJsonLightFeedAsObject);var o={metadata:e,recognizeDates:n.recognizeDates,callbackParameterName:n.callbackParameterName,formatQueryString:n.formatQueryString,enableJsonpCallback:n.enableJsonpCallback,useJsonLight:n.useJsonLight,inferJsonLightFeedAsObject:n.inferJsonLightFeedAsObject};try{return oc(n,u,o),cw(n,t,i,u,f,o)}catch(s){i(s)}},r.parseMetadata=function(n){return ga(null,n)},r.batchHandler.partHandler=r.defaultHandler;var ft=null,iit=function(){var t={v:this.valueOf(),t:"[object Date]"},n;for(n in this)t[n]=this[n];return t},rit=function(n,t){var r,i;if(t&&t.t==="[object Date]"){r=new Date(t.v);for(i in t)i!=="t"&&i!=="v"&&(r[i]=t[i]);t=r}return t},sf=function(n,t){return n.name+"#!#"+t},oy=function(n,t){return t.replace(n.name+"#!#","")},y=function(n){this.name=n};y.create=function(t){if(y.isSupported())return ft=ft||n.localStorage,new y(t);throw{message:"Web Storage not supported by the browser"};},y.isSupported=function(){return!!n.localStorage},y.prototype.add=function(n,t,i,r){r=r||this.defaultError;var u=this;this.contains(n,function(f){f?o(r,{message:"key already exists",key:n}):u.addOrUpdate(n,t,i,r)},r)},y.prototype.addOrUpdate=function(i,r,u,f){var s,h,e;if(f=f||this.defaultError,i instanceof Array)f({message:"Array of keys not supported"});else{s=sf(this,i),h=Date.prototype.toJSON;try{e=r,e!==t&&(Date.prototype.toJSON=iit,e=n.JSON.stringify(r)),ft.setItem(s,e),o(u,i,r)}catch(c){c.code===22||c.number===2147942414?o(f,{name:"QUOTA_EXCEEDED_ERR",error:c}):o(f,c)}finally{Date.prototype.toJSON=h}}},y.prototype.clear=function(n,t){var i,r,u,f;t=t||this.defaultError;try{for(i=0,r=ft.length;r>0&&i<r;)u=ft.key(i),f=oy(this,u),u!==f?(ft.removeItem(u),r=ft.length):i++;o(n)}catch(e){o(t,e)}},y.prototype.close=function(){},y.prototype.contains=function(n,t,i){i=i||this.defaultError;try{var r=sf(this,n),u=ft.getItem(r);o(t,u!==null)}catch(f){o(i,f)}},y.prototype.defaultError=ru,y.prototype.getAllKeys=function(n,t){var r,i,e,u,f;t=t||this.defaultError,r=[];try{for(i=0,e=ft.length;i<e;i++)u=ft.key(i),f=oy(this,u),u!==f&&r.push(f);o(n,r)}catch(s){o(t,s)}},y.prototype.mechanism="dom",y.prototype.read=function(i,r,u){if(u=u||this.defaultError,i instanceof Array)u({message:"Array of keys not supported"});else try{var e=sf(this,i),f=ft.getItem(e);f=f!==null&&f!=="undefined"?n.JSON.parse(f,rit):t,o(r,i,f)}catch(s){o(u,s)}},y.prototype.remove=function(n,t,i){if(i=i||this.defaultError,n instanceof Array)i({message:"Batches not supported"});else try{var r=sf(this,n);ft.removeItem(r),o(t)}catch(u){o(i,u)}},y.prototype.update=function(n,t,i,r){r=r||this.defaultError;var u=this;this.contains(n,function(f){f?u.addOrUpdate(n,t,i,r):o(r,{message:"key not found",key:n})},r)};var sy=n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.indexedDB,uit=n.IDBKeyRange||n.webkitIDBKeyRange,hy=n.IDBTransaction||n.webkitIDBTransaction||{},cy=hy.READ_ONLY||"readonly",rr=hy.READ_WRITE||"readwrite",yt=function(n,t){return function(i){var r=n||t,u,f;if(r){if(Object.prototype.toString.call(i)==="[object IDBDatabaseException]"){if(i.code===11){r({name:"QuotaExceededError",error:i});return}r(i);return}try{f=i.target.error||i,u=f.name}catch(e){u=i.type==="blocked"?"IndexedDBBlocked":"UnknownError"}r({name:u,error:i})}}},fit=function(n,t,i){var u=n.name,f="_datajs_"+u,r=sy.open(f);r.onblocked=i,r.onerror=i,r.onupgradeneeded=function(){var n=r.result;n.objectStoreNames.contains(u)||n.createObjectStore(u)},r.onsuccess=function(n){var f=r.result,e;if(!f.objectStoreNames.contains(u)){if("setVersion"in f){e=f.setVersion("1.0"),e.onsuccess=function(){var n=e.transaction;n.oncomplete=function(){t(f)},f.createObjectStore(u,null,!1)},e.onerror=i,e.onblocked=i;return}n.target.error={name:"DBSchemaMismatch"},i(n);return}f.onversionchange=function(n){n.target.close()},t(f)}},fi=function(n,t,i,r){var u=n.name,f=n.db,e=yt(r,n.defaultError);if(f){i(f.transaction(u,t));return}fit(n,function(r){n.db=r,i(r.transaction(u,t))},e)},w=function(n){this.name=n};w.create=function(n){if(w.isSupported())return new w(n);throw{message:"IndexedDB is not supported on this browser"};},w.isSupported=function(){return!!sy},w.prototype.add=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),fi(this,rr,function(s){s.onabort=yt(r,o,n,"add"),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)};for(var h=0;h<u.length&&h<f.length;h++)s.objectStore(e).add({v:f[h]},u[h])},r)},w.prototype.addOrUpdate=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),fi(this,rr,function(s){var h,c;for(s.onabort=yt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)},h=0;h<u.length&&h<f.length;h++)c={v:f[h]},s.objectStore(e).put(c,u[h])},r)},w.prototype.clear=function(n,t){var i=this.name,r=this.defaultError;fi(this,rr,function(u){u.onerror=yt(t,r),u.oncomplete=function(){n()},u.objectStore(i).clear()},t)},w.prototype.close=function(){this.db&&(this.db.close(),this.db=null)},w.prototype.contains=function(n,t,i){var r=this.name,u=this.defaultError;fi(this,cy,function(f){var e=f.objectStore(r),o=e.get(n);f.oncomplete=function(){t(!!o.result)},f.onerror=yt(i,u)},i)},w.prototype.defaultError=ru,w.prototype.getAllKeys=function(n,t){var i=this.name,r=this.defaultError;fi(this,rr,function(u){var e=[],f;u.oncomplete=function(){n(e)},f=u.objectStore(i).openCursor(),f.onerror=yt(t,r),f.onsuccess=function(n){var t=n.target.result;t&&(e.push(t.key),t["continue"].call(t))}},t)},w.prototype.mechanism="indexeddb",w.prototype.read=function(n,i,r){var f=this.name,e=this.defaultError,u=n instanceof Array?n:[n];fi(this,cy,function(o){var h=[],s,c,l;for(o.onerror=yt(r,e,n,"read"),o.oncomplete=function(){n instanceof Array?i(u,h):i(u[0],h[0])},s=0;s<u.length;s++)c=o.objectStore(f),l=c.get.call(c,u[s]),l.onsuccess=function(n){var i=n.target.result;h.push(i?i.v:t)}},r)},w.prototype.remove=function(n,t,i){var u=this.name,f=this.defaultError,r=n instanceof Array?n:[n];fi(this,rr,function(n){var e,o;for(n.onerror=yt(i,f),n.oncomplete=function(){t()},e=0;e<r.length;e++)o=n.objectStore(u),o["delete"].call(o,r[e])},i)},w.prototype.update=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),fi(this,rr,function(s){var h,c,l;for(s.onabort=yt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)},h=0;h<u.length&&h<f.length;h++)c=s.objectStore(e).openCursor(uit.only(u[h])),l={v:f[h]},c.pair={key:u[h],value:l},c.onsuccess=function(n){var t=n.target.result;t?t.update(n.target.pair.value):s.abort()}},r)},ei=function(n){var e=[],r=[],i={},u,f;this.name=n,u=function(n){return n||this.defaultError},f=function(n,i){var r;return(n instanceof Array&&(r="Array of keys not supported"),(n===t||n===null)&&(r="Invalid key"),r)?(o(i,{message:r}),!1):!0},this.add=function(n,t,r,e){e=u(e),f(n,e)&&(i.hasOwnProperty(n)?e({message:"key already exists",key:n}):this.addOrUpdate(n,t,r,e))},this.addOrUpdate=function(n,s,h,c){if(c=u(c),f(n,c)){var l=i[n];l===t&&(l=e.length>0?e.splice(0,1):r.length),r[l]=s,i[n]=l,o(h,n,s)}},this.clear=function(n){r=[],i={},e=[],o(n)},this.contains=function(n,t){var r=i.hasOwnProperty(n);o(t,r)},this.getAllKeys=function(n){var t=[],r;for(r in i)t.push(r);o(n,t)},this.read=function(n,t,e){if(e=u(e),f(n,e)){var s=i[n];o(t,n,r[s])}},this.remove=function(n,s,h){if(h=u(h),f(n,h)){var c=i[n];c!==t&&(c===r.length-1?r.pop():(r[c]=t,e.push(c)),delete i[n],r.length===0&&(e=[])),o(s)}},this.update=function(n,t,r,e){e=u(e),f(n,e)&&(i.hasOwnProperty(n)?this.addOrUpdate(n,t,r,e):e({message:"key not found",key:n}))}},ei.create=function(n){return new ei(n)},ei.isSupported=function(){return!0},ei.prototype.close=function(){},ei.prototype.defaultError=ru,ei.prototype.mechanism="memory",ly={indexeddb:w,dom:y,memory:ei},pt.defaultStoreMechanism="best",pt.createStore=function(n,t){t||(t=pt.defaultStoreMechanism),t==="best"&&(t=y.isSupported()?"dom":"memory");var i=ly[t];if(i)return i.create(n);throw{message:"Failed to create store",name:n,mechanism:t};};var eit=function(n,t){var i=n.indexOf("?")>=0?"&":"?";return n+i+t},oit=function(n,t){var i=n.indexOf("?"),r="";return i>=0&&(r=n.substr(i),n=n.substr(0,i)),n[n.length-1]!=="/"&&(n+="/"),n+t+r},ay=function(n,t){return{method:"GET",requestUri:n,user:t.user,password:t.password,enableJsonpCallback:t.enableJsonpCallback,callbackParameterName:t.callbackParameterName,formatQueryString:t.formatQueryString}},pit=function(n,t){var u=-1,r=n.indexOf("?"),i;return r!==-1&&(i=n.indexOf("?"+t+"=",r),i===-1&&(i=n.indexOf("&"+t+"=",r)),i!==-1&&(u=i+t.length+2)),u},sit=function(n,t,i,r){return vy(n,t,[],i,r)},vy=function(n,i,u,f,e){var s=ay(n,i),o=r.request(s,function(n){var t=n.__next,r=n.results;u=u.concat(r),t?o=vy(t,i,u,f,e):f(u)},e,t,i.httpClient,i.metadata);return{abort:function(){o.abort()}}},hit=function(n){var i=this,u=n.source;return i.identifier=ep(encodeURI(decodeURI(u))),i.options=n,i.count=function(n,f){var e=i.options;return r.request(ay(oit(u,"$count"),e),function(t){var i=s(t.toString());isNaN(i)?f({message:"Count is NaN",count:i}):n(i)},f,t,e.httpClient,e.metadata)},i.read=function(n,t,r,f){var e="$skip="+n+"&$top="+t;return sit(eit(u,e),i.options,r,f)},i},cit=function(n,t){var r=lit(n,t),i,u;r&&(i=r.i-t.i,u=i+(n.c-n.d.length),n.d=n.d.concat(t.d.slice(i,u)))},lit=function(n,t){var r=n.i+n.c,u=t.i+t.c,i=n.i>t.i?n.i:t.i,f=r<u?r:u,e;return f>=i&&(e={i:i,c:f-i}),e},yy=function(n,i){if(n===t||typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<0||!isFinite(n))throw{message:"'"+i+"' must be greater than or equal to zero."};},ait=function(n,i){if(n!==t){if(typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<=0||!isFinite(n))throw{message:"'"+i+"' must be greater than zero."};}},py=function(n,i){if(n!==t&&(typeof n!="number"||isNaN(n)||!isFinite(n)))throw{message:"'"+i+"' must be a number."};},ao=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return n.splice(i,1),!0;return!1},wy=function(n){var t=0,r=typeof n,i;if(r==="object"&&n)for(i in n)t+=i.length*2+wy(n[i]);else t=r==="string"?n.length*2:8;return t},by=function(n,t,i){return n=Math.floor(n/i)*i,t=Math.ceil((t+1)/i)*i,{i:n,c:t-n}},hf="destroy",ai="idle",ky="init",vo="read",yo="prefetch",po="write",gr="cancel",oi="end",wo="error",vi="start",dy="wait",gy="clear",nu="done",tu="local",np="save",tp="source",ur=function(n,t,i,r,u,f,e){var h,c,o=this,l,s;return o.p=t,o.i=r,o.c=u,o.d=f,o.s=vi,o.canceled=!1,o.pending=e,o.oncomplete=null,o.cancel=function(){if(i){var n=o.s;n!==wo&&n!==oi&&n!==gr&&(o.canceled=!0,s(gr,h))}},o.complete=function(){s(oi,h)},o.error=function(n){o.canceled||s(wo,n)},o.run=function(n){c=n,o.transition(o.s,h)},o.wait=function(n){s(dy,n)},l=function(t,i,r){switch(t){case vi:i!==ky&&n(o,t,i,r);break;case dy:n(o,t,i,r);break;case gr:n(o,t,i,r),o.fireCanceled(),s(oi);break;case wo:n(o,t,i,r),o.canceled=!0,o.fireRejected(r),s(oi);break;case oi:if(o.oncomplete)o.oncomplete(o);o.canceled||o.fireResolved(),n(o,t,i,r);break;default:n(o,t,i,r)}},s=function(n,t){o.s=n,h=t,l(n,c,t)},o.transition=s,o};ur.prototype.fireResolved=function(){var n=this.p;n&&(this.p=null,n.resolve(this.d))},ur.prototype.fireRejected=function(n){var t=this.p;t&&(this.p=null,t.reject(n))},ur.prototype.fireCanceled=function(){this.fireRejected({canceled:!0,message:"Operation canceled"})},ip=function(i){var it=ky,y={counts:0,netReads:0,prefetches:0,cacheReads:0},c=[],b=[],p=[],nt=0,l=!1,k=af(i.cacheSize,1048576),a=0,h=0,d=0,tt=k===0,r=af(i.pageSize,50),ut=af(i.prefetchSize,r),ht="1.0",f,ft=0,w=i.source,v,u;typeof w=="string"&&(w=new hit(i)),w.options=i,v=pt.createStore(i.name,i.mechanism),u=this,u.onidle=i.idle,u.stats=y,u.count=function(){var n,i,t;if(f)throw f;return(n=su(),i=!1,l)?(o(function(){n.resolve(a)}),n.promise()):(t=w.count(function(i){t=null,y.counts++,n.resolve(i)},function(r){t=null,n.reject(g(r,{canceled:i}))}),g(n.promise(),{cancel:function(){t&&(i=!0,t.abort(),t=null)}}))},u.clear=function(){if(f)throw f;if(c.length===0){var n=su(),t=new ur(ii,n,!1);return et(t,c),n.promise()}return c[0].p},u.filterForward=function(n,t,i){return lt(n,t,i,!1)},u.filterBack=function(n,t,i){return lt(n,t,i,!0)},u.readRange=function(n,t){if(yy(n,"index"),yy(t,"count"),f)throw f;var i=su(),r=new ur(ui,i,!0,n,t,[],0);return et(r,b),g(i.promise(),{cancel:function(){r.cancel()}})},u.ToObservable=u.toObservable=function(){if(!n.Rx||!n.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(f)throw f;return n.Rx.Observable.CreateWithDisposable(function(n){var t=!1,i=0,f=function(i){t||n.OnError(i)},e=function(o){if(!t){for(var s=0,h=o.length;s<h;s++)n.OnNext(o[s]);o.length<r?n.OnCompleted():(i+=r,u.readRange(i,r).then(e,f))}};return u.readRange(i,r).then(e,f),{Dispose:function(){t=!0}}})};var rt=function(n){return function(t){f={message:n,error:t};for(var i=0,r=b.length;i<r;i++)b[i].fireRejected(f);for(i=0,r=c.length;i<r;i++)c[i].fireRejected(f);b=c=null}},e=function(n){if(n!==it){it=n;for(var i=c.concat(b,p),t=0,r=i.length;t<r;t++)i[t].run(it)}},ct=function(){var n=new ki;return v.clear(function(){nt=0,l=!1,a=0,h=0,d=0,tt=k===0,y={counts:0,netReads:0,prefetches:0,cacheReads:0},u.stats=y,v.close(),n.resolve()},function(t){n.reject(t)}),n},kt=function(n){var t=ao(c,n);t||(t=ao(b,n),t||ao(p,n)),ft--,e(ai)},dt=function(n){var t=new ki,u=!1,i=w.read(n,r,function(i){var r={i:n,c:i.length,d:i};t.resolve(r)},function(n){t.reject(n)});return g(t,{cancel:function(){i&&(i.abort(),u=!0,i=null)}})},lt=function(n,t,i,e){if(n=s(n),t=s(t),isNaN(n))throw{message:"'index' must be a valid number.",index:n};if(isNaN(t))throw{message:"'count' must be a valid number.",count:t};if(f)throw f;n=Math.max(n,0);var h=su(),o=[],a=!1,l=null,v=function(n,f){a||(t>=0&&o.length>=t?h.resolve(o):l=u.readRange(n,f).then(function(u){for(var l,a,y,p,s=0,c=u.length;s<c&&(t<0||o.length<t);s++)l=e?c-s-1:s,a=u[l],i(a)&&(y={index:n+l,item:a},e?o.unshift(y):o.push(y));!e&&u.length<f||e&&n<=0?h.resolve(o):(p=e?Math.max(n-r,0):n+f,v(p,r))},function(n){h.reject(n)}))},c=by(n,n,r),y=e?c.i:n,p=e?n-c.i+1:c.i+c.c-n;return v(y,p),g(h.promise(),{cancel:function(){l&&l.cancel(),a=!0}})},at=function(){u.onidle&&ft===0&&u.onidle()},gt=function(n){if(!l&&ut!==0&&!tt&&(p.length===0||p[0]&&p[0].c!==-1)){var t=new ur(ri,null,!0,n,ut,null,ut);et(t,p)}},et=function(n,t){n.oncomplete=kt,t.push(n),ft++,n.run(it)},ni=function(n){var r=!1,i=g(new ki,{cancel:function(){r=!0}}),u=vt(i,"Read page from store failure");return v.contains(n,function(f){if(!r){if(f){v.read(n,function(n,u){r||i.resolve(u!==t,u)},u);return}i.resolve(!1)}},u),i},ti=function(n,t){var e=!1,i=g(new ki,{cancel:function(){e=!0}}),r=vt(i,"Save page to store failure"),u=function(){i.resolve(!0)},f;return t.c>0?(f=wy(t),tt=k>=0&&k<nt+f,tt?u():v.addOrUpdate(n,t,function(){yt(t,f),st(u,r)},r)):(yt(t,0),st(u,r)),i},st=function(n,t){var i={actualCacheSize:nt,allDataLocal:l,cacheSize:k,collectionCount:a,highestSavedPage:h,highestSavedPageSize:d,pageSize:r,sourceId:w.identifier,version:ht};v.addOrUpdate("__settings",i,n,t)},vt=function(n){return function(){n.resolve(!1)}},yt=function(n,t){var i=n.c,u=n.i;i===0?h===u-r&&(a=h+d):(h=Math.max(h,u),h===u&&(d=i),nt+=t,i<r&&!a&&(a=u+i)),l||a!==h+d||(l=!0)},wt=function(n,t,i,r){var u=n.canceled&&t!==oi;return u&&t===gr&&r&&r.cancel&&r.cancel(),u},ii=function(n,t,i){var r=n.transition;if(i!==hf)return e(hf),!0;switch(t){case vi:r(gy);break;case oi:at();break;case gy:ct().then(function(){n.complete()}),n.wait();break;default:return!1}return!0},ri=function(n,t,i,u){var o,f;if(!wt(n,t,i,u)){if(o=n.transition,i!==yo)return i===hf?t!==gr&&n.cancel():i===ai&&e(yo),!0;switch(t){case vi:p[0]===n&&o(tu,n.i);break;case nu:f=n.pending,f>0&&(f-=Math.min(f,u.c)),l||f===0||u.c<r||tt?n.complete():(n.pending=f,o(tu,u.i+r));break;default:return bt(n,t,i,u,!0)}}return!0},ui=function(n,t,i,u){var f,o,s;if(!wt(n,t,i,u)){if(f=n.transition,i!==vo&&t!==vi)return i===hf?t!==vi&&n.cancel():i!==po&&e(vo),!0;switch(t){case vi:(i===ai||i===yo)&&(e(vo),n.c>0?(o=by(n.i,n.c,r),f(tu,o.i)):f(nu,n));break;case nu:cit(n,u),s=n.d.length,n.c===s||u.c<r?(y.cacheReads++,gt(u.i+u.c),n.complete()):f(tu,u.i+r);break;default:return bt(n,t,i,u,!1)}}return!0},bt=function(n,t,i,r,u){var s=n.error,o=n.transition,h=n.wait,f;switch(t){case oi:at();break;case tu:f=ni(r).then(function(t,i){n.canceled||(t?o(nu,i):o(tp,r))});break;case tp:f=dt(r).then(function(t){n.canceled||(u?y.prefetches++:y.netReads++,o(np,t))},s);break;case np:i!==po&&(e(po),f=ti(r.i,r).then(function(t){n.canceled||(!t&&u&&(n.pending=0),o(nu,r)),e(ai)}));break;default:return!1}return f&&(n.canceled?f.cancel():n.s===t&&h(f)),!0};return v.read("__settings",function(n,t){if(ot(t)){var i=t.version;if(!i||i.indexOf("1.")!==0){rt("Unsupported cache store version "+i)();return}r!==t.pageSize||w.identifier!==t.sourceId?ct().then(function(){e(ai)},rt("Unable to clear store during initialization")):(nt=t.actualCacheSize,l=t.allDataLocal,k=t.cacheSize,a=t.collectionCount,h=t.highestSavedPage,d=t.highestSavedPageSize,ht=i,e(ai))}else st(function(){e(ai)},rt("Unable to write settings during initialization."))},rt("Unable to read settings from store.")),u},pt.createDataCache=function(n){if(ait(n.pageSize,"pageSize"),py(n.cacheSize,"cacheSize"),py(n.prefetchSize,"prefetchSize"),!ot(n.name))throw{message:"Undefined or null name",options:n};if(!ot(n.source))throw{message:"Undefined source",options:n};return new ip(n)}})(this)